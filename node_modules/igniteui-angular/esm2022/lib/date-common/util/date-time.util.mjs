import { DatePart } from '../../directives/date-time-editor/date-time-editor.common';
import { formatDate, FormatWidth, getLocaleDateFormat } from '@angular/common';
import { isDate } from '../../core/utils';
const TIME_CHARS = ['h', 'H', 'm', 's', 'S', 't', 'T', 'a'];
const DATE_CHARS = ['d', 'D', 'M', 'y', 'Y'];
/** @hidden */
export class DateTimeUtil {
    static { this.DEFAULT_INPUT_FORMAT = 'MM/dd/yyyy'; }
    static { this.DEFAULT_TIME_INPUT_FORMAT = 'hh:mm tt'; }
    static { this.SEPARATOR = 'literal'; }
    static { this.DEFAULT_LOCALE = 'en'; }
    /**
     * Parse a Date value from masked string input based on determined date parts
     *
     * @param inputData masked value to parse
     * @param dateTimeParts Date parts array for the mask
     */
    static parseValueFromMask(inputData, dateTimeParts, promptChar) {
        const parts = {};
        dateTimeParts.forEach(dp => {
            let value = parseInt(DateTimeUtil.getCleanVal(inputData, dp, promptChar), 10);
            if (!value) {
                value = dp.type === DatePart.Date || dp.type === DatePart.Month ? 1 : 0;
            }
            parts[dp.type] = value;
        });
        parts[DatePart.Month] -= 1;
        if (parts[DatePart.Month] < 0 || 11 < parts[DatePart.Month]) {
            return null;
        }
        // TODO: Century threshold
        if (parts[DatePart.Year] < 50) {
            parts[DatePart.Year] += 2000;
        }
        if (parts[DatePart.Date] > DateTimeUtil.daysInMonth(parts[DatePart.Year], parts[DatePart.Month])) {
            return null;
        }
        if (parts[DatePart.Hours] > 23 || parts[DatePart.Minutes] > 59
            || parts[DatePart.Seconds] > 59 || parts[DatePart.FractionalSeconds] > 999) {
            return null;
        }
        const amPm = dateTimeParts.find(p => p.type === DatePart.AmPm);
        if (amPm) {
            parts[DatePart.Hours] %= 12;
        }
        if (amPm) {
            const cleanVal = DateTimeUtil.getCleanVal(inputData, amPm, promptChar);
            if (DateTimeUtil.isPm(cleanVal)) {
                parts[DatePart.Hours] += 12;
            }
        }
        return new Date(parts[DatePart.Year] || 2000, parts[DatePart.Month] || 0, parts[DatePart.Date] || 1, parts[DatePart.Hours] || 0, parts[DatePart.Minutes] || 0, parts[DatePart.Seconds] || 0, parts[DatePart.FractionalSeconds] || 0);
    }
    /** Parse the mask into date/time and literal parts */
    static parseDateTimeFormat(mask, locale) {
        const format = mask || DateTimeUtil.getDefaultInputFormat(locale);
        const dateTimeParts = [];
        const formatArray = Array.from(format);
        let currentPart = null;
        let position = 0;
        let lastPartAdded = false;
        for (let i = 0; i < formatArray.length; i++, position++) {
            const type = DateTimeUtil.determineDatePart(formatArray[i]);
            if (currentPart) {
                if (currentPart.type === type) {
                    currentPart.format += formatArray[i];
                    if (i < formatArray.length - 1) {
                        continue;
                    }
                }
                if (currentPart.type === DatePart.AmPm && currentPart.format.indexOf('a') !== -1) {
                    currentPart = DateTimeUtil.simplifyAmPmFormat(currentPart);
                }
                DateTimeUtil.addCurrentPart(currentPart, dateTimeParts);
                lastPartAdded = true;
                position = currentPart.end;
                if (i === formatArray.length - 1 && currentPart.type !== type) {
                    lastPartAdded = false;
                }
            }
            currentPart = {
                start: position,
                end: position + formatArray[i].length,
                type,
                format: formatArray[i]
            };
        }
        // make sure the last member of a format like H:m:s is not omitted
        if (!lastPartAdded) {
            if (currentPart.type === DatePart.AmPm) {
                currentPart = DateTimeUtil.simplifyAmPmFormat(currentPart);
            }
            DateTimeUtil.addCurrentPart(currentPart, dateTimeParts);
        }
        // formats like "y" or "yyy" are treated like "yyyy" while editing
        const yearPart = dateTimeParts.filter(p => p.type === DatePart.Year)[0];
        if (yearPart && yearPart.format !== 'yy') {
            yearPart.end += 4 - yearPart.format.length;
            yearPart.format = 'yyyy';
        }
        return dateTimeParts;
    }
    /** Simplifies the AmPm part to as many chars as will be displayed */
    static simplifyAmPmFormat(currentPart) {
        currentPart.format = currentPart.format.length === 5 ? 'a' : 'aa';
        currentPart.end = currentPart.start + currentPart.format.length;
        return { ...currentPart };
    }
    static getPartValue(value, datePartInfo, partLength) {
        let maskedValue;
        const datePart = datePartInfo.type;
        switch (datePart) {
            case DatePart.Date:
                maskedValue = value.getDate();
                break;
            case DatePart.Month:
                // months are zero based
                maskedValue = value.getMonth() + 1;
                break;
            case DatePart.Year:
                if (partLength === 2) {
                    maskedValue = this.prependValue(parseInt(value.getFullYear().toString().slice(-2), 10), partLength, '0');
                }
                else {
                    maskedValue = value.getFullYear();
                }
                break;
            case DatePart.Hours:
                if (datePartInfo.format.indexOf('h') !== -1) {
                    maskedValue = this.prependValue(this.toTwelveHourFormat(value.getHours().toString()), partLength, '0');
                }
                else {
                    maskedValue = value.getHours();
                }
                break;
            case DatePart.Minutes:
                maskedValue = value.getMinutes();
                break;
            case DatePart.Seconds:
                maskedValue = value.getSeconds();
                break;
            case DatePart.FractionalSeconds:
                maskedValue = value.getMilliseconds();
                break;
            case DatePart.AmPm:
                maskedValue = DateTimeUtil.getAmPmValue(partLength, value.getHours() < 12);
                break;
        }
        if (datePartInfo.type !== DatePart.AmPm) {
            return this.prependValue(maskedValue, partLength, '0');
        }
        return maskedValue;
    }
    /** Returns the AmPm part value depending on the part length and a
     * conditional expression indicating whether the value is AM or PM.
     */
    static getAmPmValue(partLength, isAm) {
        if (isAm) {
            return partLength === 1 ? "a" /* AmPmValues.A */ : "AM" /* AmPmValues.AM */;
        }
        else {
            return partLength === 1 ? "p" /* AmPmValues.P */ : "PM" /* AmPmValues.PM */;
        }
    }
    /** Returns true if a string value indicates an AM period */
    static isAm(value) {
        value = value.toLowerCase();
        return (value === "AM" /* AmPmValues.AM */.toLowerCase() || value === "a" /* AmPmValues.A */.toLowerCase());
    }
    /** Returns true if a string value indicates a PM period */
    static isPm(value) {
        value = value.toLowerCase();
        return (value === "PM" /* AmPmValues.PM */.toLowerCase() || value === "p" /* AmPmValues.P */.toLowerCase());
    }
    /** Builds a date-time editor's default input format based on provided locale settings. */
    static getDefaultInputFormat(locale) {
        locale = locale || DateTimeUtil.DEFAULT_LOCALE;
        if (!Intl || !Intl.DateTimeFormat || !Intl.DateTimeFormat.prototype.formatToParts) {
            // TODO: fallback with Intl.format for IE?
            return DateTimeUtil.DEFAULT_INPUT_FORMAT;
        }
        const parts = DateTimeUtil.getDefaultLocaleMask(locale);
        parts.forEach(p => {
            if (p.type !== DatePart.Year && p.type !== DateTimeUtil.SEPARATOR) {
                p.formatType = "2-digit" /* FormatDesc.TwoDigits */;
            }
        });
        return DateTimeUtil.getMask(parts);
    }
    /** Tries to format a date using Angular's DatePipe. Fallbacks to `Intl` if no locale settings have been loaded. */
    static formatDate(value, format, locale, timezone) {
        let formattedDate;
        try {
            formattedDate = formatDate(value, format, locale, timezone);
        }
        catch {
            DateTimeUtil.logMissingLocaleSettings(locale);
            const formatter = new Intl.DateTimeFormat(locale);
            formattedDate = formatter.format(value);
        }
        return formattedDate;
    }
    /**
     * Returns the date format based on a provided locale.
     * Supports Angular's DatePipe format options such as `shortDate`, `longDate`.
     */
    static getLocaleDateFormat(locale, displayFormat) {
        const formatKeys = Object.keys(FormatWidth);
        const targetKey = formatKeys.find(k => k.toLowerCase() === displayFormat?.toLowerCase().replace('date', ''));
        if (!targetKey) {
            // if displayFormat is not shortDate, longDate, etc.
            // or if it is not set by the user
            return displayFormat;
        }
        let format;
        try {
            format = getLocaleDateFormat(locale, FormatWidth[targetKey]);
        }
        catch {
            DateTimeUtil.logMissingLocaleSettings(locale);
            format = DateTimeUtil.getDefaultInputFormat(locale);
        }
        return format;
    }
    /** Determines if a given character is `d/M/y` or `h/m/s`. */
    static isDateOrTimeChar(char) {
        return DATE_CHARS.indexOf(char) !== -1 || TIME_CHARS.indexOf(char) !== -1;
    }
    /** Spins the date portion in a date-time editor. */
    static spinDate(delta, newDate, spinLoop) {
        const maxDate = DateTimeUtil.daysInMonth(newDate.getFullYear(), newDate.getMonth());
        let date = newDate.getDate() + delta;
        if (date > maxDate) {
            date = spinLoop ? date % maxDate : maxDate;
        }
        else if (date < 1) {
            date = spinLoop ? maxDate + (date % maxDate) : 1;
        }
        newDate.setDate(date);
    }
    /** Spins the month portion in a date-time editor. */
    static spinMonth(delta, newDate, spinLoop) {
        const maxDate = DateTimeUtil.daysInMonth(newDate.getFullYear(), newDate.getMonth() + delta);
        if (newDate.getDate() > maxDate) {
            newDate.setDate(maxDate);
        }
        const maxMonth = 11;
        const minMonth = 0;
        let month = newDate.getMonth() + delta;
        if (month > maxMonth) {
            month = spinLoop ? (month % maxMonth) - 1 : maxMonth;
        }
        else if (month < minMonth) {
            month = spinLoop ? maxMonth + (month % maxMonth) + 1 : minMonth;
        }
        newDate.setMonth(month);
    }
    /** Spins the year portion in a date-time editor. */
    static spinYear(delta, newDate) {
        const maxDate = DateTimeUtil.daysInMonth(newDate.getFullYear() + delta, newDate.getMonth());
        if (newDate.getDate() > maxDate) {
            // clip to max to avoid leap year change shifting the entire value
            newDate.setDate(maxDate);
        }
        newDate.setFullYear(newDate.getFullYear() + delta);
    }
    /** Spins the hours portion in a date-time editor. */
    static spinHours(delta, newDate, spinLoop) {
        const maxHour = 23;
        const minHour = 0;
        let hours = newDate.getHours() + delta;
        if (hours > maxHour) {
            hours = spinLoop ? hours % maxHour - 1 : maxHour;
        }
        else if (hours < minHour) {
            hours = spinLoop ? maxHour + (hours % maxHour) + 1 : minHour;
        }
        newDate.setHours(hours);
    }
    /** Spins the minutes portion in a date-time editor. */
    static spinMinutes(delta, newDate, spinLoop) {
        const maxMinutes = 59;
        const minMinutes = 0;
        let minutes = newDate.getMinutes() + delta;
        if (minutes > maxMinutes) {
            minutes = spinLoop ? minutes % maxMinutes - 1 : maxMinutes;
        }
        else if (minutes < minMinutes) {
            minutes = spinLoop ? maxMinutes + (minutes % maxMinutes) + 1 : minMinutes;
        }
        newDate.setMinutes(minutes);
    }
    /** Spins the seconds portion in a date-time editor. */
    static spinSeconds(delta, newDate, spinLoop) {
        const maxSeconds = 59;
        const minSeconds = 0;
        let seconds = newDate.getSeconds() + delta;
        if (seconds > maxSeconds) {
            seconds = spinLoop ? seconds % maxSeconds - 1 : maxSeconds;
        }
        else if (seconds < minSeconds) {
            seconds = spinLoop ? maxSeconds + (seconds % maxSeconds) + 1 : minSeconds;
        }
        newDate.setSeconds(seconds);
    }
    /** Spins the fractional seconds (milliseconds) portion in a date-time editor. */
    static spinFractionalSeconds(delta, newDate, spinLoop) {
        const maxMs = 999;
        const minMs = 0;
        let ms = newDate.getMilliseconds() + delta;
        if (ms > maxMs) {
            ms = spinLoop ? ms % maxMs - 1 : maxMs;
        }
        else if (ms < minMs) {
            ms = spinLoop ? maxMs + (ms % maxMs) + 1 : minMs;
        }
        newDate.setMilliseconds(ms);
    }
    /** Spins the AM/PM portion in a date-time editor. */
    static spinAmPm(newDate, currentDate, amPmFromMask) {
        if (DateTimeUtil.isAm(amPmFromMask)) {
            newDate = new Date(newDate.setHours(newDate.getHours() + 12));
        }
        else if (DateTimeUtil.isPm(amPmFromMask)) {
            newDate = new Date(newDate.setHours(newDate.getHours() - 12));
        }
        if (newDate.getDate() !== currentDate.getDate()) {
            return currentDate;
        }
        return newDate;
    }
    /**
     * Determines whether the provided value is greater than the provided max value.
     *
     * @param includeTime set to false if you want to exclude time portion of the two dates
     * @param includeDate set to false if you want to exclude the date portion of the two dates
     * @returns true if provided value is greater than provided maxValue
     */
    static greaterThanMaxValue(value, maxValue, includeTime = true, includeDate = true) {
        if (includeTime && includeDate) {
            return value.getTime() > maxValue.getTime();
        }
        const _value = new Date(value.getTime());
        const _maxValue = new Date(maxValue.getTime());
        if (!includeTime) {
            _value.setHours(0, 0, 0, 0);
            _maxValue.setHours(0, 0, 0, 0);
        }
        if (!includeDate) {
            _value.setFullYear(0, 0, 0);
            _maxValue.setFullYear(0, 0, 0);
        }
        return _value.getTime() > _maxValue.getTime();
    }
    /**
     * Determines whether the provided value is less than the provided min value.
     *
     * @param includeTime set to false if you want to exclude time portion of the two dates
     * @param includeDate set to false if you want to exclude the date portion of the two dates
     * @returns true if provided value is less than provided minValue
     */
    static lessThanMinValue(value, minValue, includeTime = true, includeDate = true) {
        if (includeTime && includeDate) {
            return value.getTime() < minValue.getTime();
        }
        const _value = new Date(value.getTime());
        const _minValue = new Date(minValue.getTime());
        if (!includeTime) {
            _value.setHours(0, 0, 0, 0);
            _minValue.setHours(0, 0, 0, 0);
        }
        if (!includeDate) {
            _value.setFullYear(0, 0, 0);
            _minValue.setFullYear(0, 0, 0);
        }
        return _value.getTime() < _minValue.getTime();
    }
    /**
     * Validates a value within a given min and max value range.
     *
     * @param value The value to validate
     * @param minValue The lowest possible value that `value` can take
     * @param maxValue The largest possible value that `value` can take
     */
    static validateMinMax(value, minValue, maxValue, includeTime = true, includeDate = true) {
        if (!value) {
            return null;
        }
        const errors = {};
        const min = DateTimeUtil.isValidDate(minValue) ? minValue : DateTimeUtil.parseIsoDate(minValue);
        const max = DateTimeUtil.isValidDate(maxValue) ? maxValue : DateTimeUtil.parseIsoDate(maxValue);
        if (min && value && DateTimeUtil.lessThanMinValue(value, min, includeTime, includeDate)) {
            Object.assign(errors, { minValue: true });
        }
        if (max && value && DateTimeUtil.greaterThanMaxValue(value, max, includeTime, includeDate)) {
            Object.assign(errors, { maxValue: true });
        }
        return errors;
    }
    /** Parse an ISO string to a Date */
    static parseIsoDate(value) {
        let regex = /^\d{4}/g;
        const timeLiteral = 'T';
        if (regex.test(value)) {
            return new Date(value + `${value.indexOf(timeLiteral) === -1 ? 'T00:00:00' : ''}`);
        }
        regex = /^\d{2}/g;
        if (regex.test(value)) {
            const dateNow = new Date().toISOString();
            // eslint-disable-next-line prefer-const
            let [datePart, _timePart] = dateNow.split(timeLiteral);
            return new Date(`${datePart}T${value}`);
        }
        return null;
    }
    /**
     * Returns whether the input is valid date
     *
     * @param value input to check
     * @returns true if provided input is a valid date
     */
    static isValidDate(value) {
        if (isDate(value)) {
            return !isNaN(value.getTime());
        }
        return false;
    }
    static addCurrentPart(currentPart, dateTimeParts) {
        DateTimeUtil.ensureLeadingZero(currentPart);
        currentPart.end = currentPart.start + currentPart.format.length;
        dateTimeParts.push(currentPart);
    }
    static daysInMonth(fullYear, month) {
        return new Date(fullYear, month + 1, 0).getDate();
    }
    static trimEmptyPlaceholders(value, promptChar) {
        const result = value.replace(new RegExp(promptChar || '_', 'g'), '');
        return result;
    }
    static getMask(dateStruct) {
        const mask = [];
        for (const part of dateStruct) {
            switch (part.formatType) {
                case "numeric" /* FormatDesc.Numeric */: {
                    if (part.type === "day" /* DateParts.Day */) {
                        mask.push('d');
                    }
                    else if (part.type === "month" /* DateParts.Month */) {
                        mask.push('M');
                    }
                    else {
                        mask.push('yyyy');
                    }
                    break;
                }
                case "2-digit" /* FormatDesc.TwoDigits */: {
                    if (part.type === "day" /* DateParts.Day */) {
                        mask.push('dd');
                    }
                    else if (part.type === "month" /* DateParts.Month */) {
                        mask.push('MM');
                    }
                    else {
                        mask.push('yy');
                    }
                }
            }
            if (part.type === DateTimeUtil.SEPARATOR) {
                mask.push(part.value);
            }
        }
        return mask.join('');
    }
    static logMissingLocaleSettings(locale) {
        console.warn(`Missing locale data for the locale ${locale}. Please refer to https://angular.io/guide/i18n#i18n-pipes`);
        console.warn('Using default browser locale settings.');
    }
    static prependValue(value, partLength, prependChar) {
        return (prependChar + value.toString()).slice(-partLength);
    }
    static toTwelveHourFormat(value, promptChar = '_') {
        let hour = parseInt(value.replace(new RegExp(promptChar, 'g'), '0'), 10);
        if (hour > 12) {
            hour -= 12;
        }
        else if (hour === 0) {
            hour = 12;
        }
        return hour;
    }
    static ensureLeadingZero(part) {
        switch (part.type) {
            case DatePart.Date:
            case DatePart.Month:
            case DatePart.Hours:
            case DatePart.Minutes:
            case DatePart.Seconds:
                if (part.format.length === 1) {
                    part.format = part.format.repeat(2);
                }
                break;
            case DatePart.FractionalSeconds:
                part.format = part.format[0].repeat(3);
                break;
        }
    }
    static getCleanVal(inputData, datePart, promptChar) {
        return DateTimeUtil.trimEmptyPlaceholders(inputData.substring(datePart.start, datePart.end), promptChar);
    }
    static determineDatePart(char) {
        switch (char) {
            case 'd':
            case 'D':
                return DatePart.Date;
            case 'M':
                return DatePart.Month;
            case 'y':
            case 'Y':
                return DatePart.Year;
            case 'h':
            case 'H':
                return DatePart.Hours;
            case 'm':
                return DatePart.Minutes;
            case 's':
                return DatePart.Seconds;
            case 'S':
                return DatePart.FractionalSeconds;
            case 'a':
            case 't':
            case 'T':
                return DatePart.AmPm;
            default:
                return DatePart.Literal;
        }
    }
    static getDefaultLocaleMask(locale) {
        const dateStruct = [];
        const formatter = new Intl.DateTimeFormat(locale);
        const formatToParts = formatter.formatToParts(new Date());
        for (const part of formatToParts) {
            if (part.type === DateTimeUtil.SEPARATOR) {
                dateStruct.push({
                    type: DateTimeUtil.SEPARATOR,
                    value: part.value
                });
            }
            else {
                dateStruct.push({
                    type: part.type
                });
            }
        }
        const formatterOptions = formatter.resolvedOptions();
        for (const part of dateStruct) {
            switch (part.type) {
                case "day" /* DateParts.Day */: {
                    part.formatType = formatterOptions.day;
                    break;
                }
                case "month" /* DateParts.Month */: {
                    part.formatType = formatterOptions.month;
                    break;
                }
                case "year" /* DateParts.Year */: {
                    part.formatType = formatterOptions.year;
                    break;
                }
            }
        }
        DateTimeUtil.fillDatePartsPositions(dateStruct);
        return dateStruct;
    }
    static fillDatePartsPositions(dateArray) {
        let currentPos = 0;
        for (const part of dateArray) {
            // Day|Month part positions
            if (part.type === "day" /* DateParts.Day */ || part.type === "month" /* DateParts.Month */) {
                // Offset 2 positions for number
                part.position = [currentPos, currentPos + 2];
                currentPos += 2;
            }
            else if (part.type === "year" /* DateParts.Year */) {
                // Year part positions
                switch (part.formatType) {
                    case "numeric" /* FormatDesc.Numeric */: {
                        // Offset 4 positions for full year
                        part.position = [currentPos, currentPos + 4];
                        currentPos += 4;
                        break;
                    }
                    case "2-digit" /* FormatDesc.TwoDigits */: {
                        // Offset 2 positions for short year
                        part.position = [currentPos, currentPos + 2];
                        currentPos += 2;
                        break;
                    }
                }
            }
            else if (part.type === DateTimeUtil.SEPARATOR) {
                // Separator positions
                part.position = [currentPos, currentPos + 1];
                currentPos++;
            }
        }
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0ZS10aW1lLnV0aWwuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9pZ25pdGV1aS1hbmd1bGFyL3NyYy9saWIvZGF0ZS1jb21tb24vdXRpbC9kYXRlLXRpbWUudXRpbC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsUUFBUSxFQUFnQixNQUFNLDJEQUEyRCxDQUFDO0FBQ25HLE9BQU8sRUFBRSxVQUFVLEVBQUUsV0FBVyxFQUFFLG1CQUFtQixFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFFL0UsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBUTFDLE1BQU0sVUFBVSxHQUFHLENBQUMsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsQ0FBQyxDQUFDO0FBQzVELE1BQU0sVUFBVSxHQUFHLENBQUMsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsQ0FBQyxDQUFDO0FBaUI3QyxjQUFjO0FBQ2QsTUFBTSxPQUFnQixZQUFZO2FBQ1AseUJBQW9CLEdBQUcsWUFBWSxDQUFDO2FBQ3BDLDhCQUF5QixHQUFHLFVBQVUsQ0FBQzthQUN0QyxjQUFTLEdBQUcsU0FBUyxDQUFDO2FBQ3RCLG1CQUFjLEdBQUcsSUFBSSxDQUFDO0lBRTlDOzs7OztPQUtHO0lBQ0ksTUFBTSxDQUFDLGtCQUFrQixDQUFDLFNBQWlCLEVBQUUsYUFBNkIsRUFBRSxVQUFtQjtRQUNsRyxNQUFNLEtBQUssR0FBa0MsRUFBUyxDQUFDO1FBQ3ZELGFBQWEsQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDLEVBQUU7WUFDdkIsSUFBSSxLQUFLLEdBQUcsUUFBUSxDQUFDLFlBQVksQ0FBQyxXQUFXLENBQUMsU0FBUyxFQUFFLEVBQUUsRUFBRSxVQUFVLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQztZQUM5RSxJQUFJLENBQUMsS0FBSyxFQUFFLENBQUM7Z0JBQ1QsS0FBSyxHQUFHLEVBQUUsQ0FBQyxJQUFJLEtBQUssUUFBUSxDQUFDLElBQUksSUFBSSxFQUFFLENBQUMsSUFBSSxLQUFLLFFBQVEsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQzVFLENBQUM7WUFDRCxLQUFLLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxHQUFHLEtBQUssQ0FBQztRQUMzQixDQUFDLENBQUMsQ0FBQztRQUNILEtBQUssQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBRTNCLElBQUksS0FBSyxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLElBQUksRUFBRSxHQUFHLEtBQUssQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQztZQUMxRCxPQUFPLElBQUksQ0FBQztRQUNoQixDQUFDO1FBRUQsMEJBQTBCO1FBQzFCLElBQUksS0FBSyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFLEVBQUUsQ0FBQztZQUM1QixLQUFLLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxJQUFJLElBQUksQ0FBQztRQUNqQyxDQUFDO1FBRUQsSUFBSSxLQUFLLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxHQUFHLFlBQVksQ0FBQyxXQUFXLENBQUMsS0FBSyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsRUFBRSxLQUFLLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUUsQ0FBQztZQUMvRixPQUFPLElBQUksQ0FBQztRQUNoQixDQUFDO1FBRUQsSUFBSSxLQUFLLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxHQUFHLEVBQUUsSUFBSSxLQUFLLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxHQUFHLEVBQUU7ZUFDdkQsS0FBSyxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUMsR0FBRyxFQUFFLElBQUksS0FBSyxDQUFDLFFBQVEsQ0FBQyxpQkFBaUIsQ0FBQyxHQUFHLEdBQUcsRUFBRSxDQUFDO1lBQzdFLE9BQU8sSUFBSSxDQUFDO1FBQ2hCLENBQUM7UUFFRCxNQUFNLElBQUksR0FBRyxhQUFhLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksS0FBSyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDL0QsSUFBSSxJQUFJLEVBQUUsQ0FBQztZQUNQLEtBQUssQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLElBQUksRUFBRSxDQUFDO1FBQ2hDLENBQUM7UUFFRCxJQUFJLElBQUksRUFBRSxDQUFDO1lBQ1AsTUFBTSxRQUFRLEdBQUcsWUFBWSxDQUFDLFdBQVcsQ0FBQyxTQUFTLEVBQUUsSUFBSSxFQUFFLFVBQVUsQ0FBQyxDQUFDO1lBQ3ZFLElBQUksWUFBWSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDO2dCQUM5QixLQUFLLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxJQUFJLEVBQUUsQ0FBQztZQUNoQyxDQUFDO1FBQ0wsQ0FBQztRQUVELE9BQU8sSUFBSSxJQUFJLENBQ1gsS0FBSyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsSUFBSSxJQUFJLEVBQzVCLEtBQUssQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxFQUMxQixLQUFLLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsRUFDekIsS0FBSyxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLEVBQzFCLEtBQUssQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxFQUM1QixLQUFLLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsRUFDNUIsS0FBSyxDQUFDLFFBQVEsQ0FBQyxpQkFBaUIsQ0FBQyxJQUFJLENBQUMsQ0FDekMsQ0FBQztJQUNOLENBQUM7SUFFRCxzREFBc0Q7SUFDL0MsTUFBTSxDQUFDLG1CQUFtQixDQUFDLElBQVksRUFBRSxNQUFlO1FBQzNELE1BQU0sTUFBTSxHQUFHLElBQUksSUFBSSxZQUFZLENBQUMscUJBQXFCLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDbEUsTUFBTSxhQUFhLEdBQW1CLEVBQUUsQ0FBQztRQUN6QyxNQUFNLFdBQVcsR0FBRyxLQUFLLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQ3ZDLElBQUksV0FBVyxHQUFpQixJQUFJLENBQUM7UUFDckMsSUFBSSxRQUFRLEdBQUcsQ0FBQyxDQUFDO1FBQ2pCLElBQUksYUFBYSxHQUFHLEtBQUssQ0FBQztRQUMxQixLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsV0FBVyxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFBRSxRQUFRLEVBQUUsRUFBRSxDQUFDO1lBQ3RELE1BQU0sSUFBSSxHQUFHLFlBQVksQ0FBQyxpQkFBaUIsQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUM1RCxJQUFJLFdBQVcsRUFBRSxDQUFDO2dCQUNkLElBQUksV0FBVyxDQUFDLElBQUksS0FBSyxJQUFJLEVBQUUsQ0FBQztvQkFDNUIsV0FBVyxDQUFDLE1BQU0sSUFBSSxXQUFXLENBQUMsQ0FBQyxDQUFDLENBQUM7b0JBQ3JDLElBQUksQ0FBQyxHQUFHLFdBQVcsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFLENBQUM7d0JBQzdCLFNBQVM7b0JBQ2IsQ0FBQztnQkFDTCxDQUFDO2dCQUVELElBQUksV0FBVyxDQUFDLElBQUksS0FBSyxRQUFRLENBQUMsSUFBSSxJQUFJLFdBQVcsQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLENBQUM7b0JBQy9FLFdBQVcsR0FBRyxZQUFZLENBQUMsa0JBQWtCLENBQUMsV0FBVyxDQUFDLENBQUM7Z0JBQy9ELENBQUM7Z0JBQ0QsWUFBWSxDQUFDLGNBQWMsQ0FBQyxXQUFXLEVBQUUsYUFBYSxDQUFDLENBQUM7Z0JBQ3hELGFBQWEsR0FBRyxJQUFJLENBQUM7Z0JBQ3JCLFFBQVEsR0FBRyxXQUFXLENBQUMsR0FBRyxDQUFDO2dCQUMzQixJQUFHLENBQUMsS0FBSyxXQUFXLENBQUMsTUFBTSxHQUFHLENBQUMsSUFBSSxXQUFXLENBQUMsSUFBSSxLQUFLLElBQUksRUFBRSxDQUFDO29CQUMzRCxhQUFhLEdBQUcsS0FBSyxDQUFDO2dCQUMxQixDQUFDO1lBQ0wsQ0FBQztZQUVELFdBQVcsR0FBRztnQkFDVixLQUFLLEVBQUUsUUFBUTtnQkFDZixHQUFHLEVBQUUsUUFBUSxHQUFHLFdBQVcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNO2dCQUNyQyxJQUFJO2dCQUNKLE1BQU0sRUFBRSxXQUFXLENBQUMsQ0FBQyxDQUFDO2FBQ3pCLENBQUM7UUFDTixDQUFDO1FBRUQsa0VBQWtFO1FBQ2xFLElBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQztZQUNqQixJQUFJLFdBQVcsQ0FBQyxJQUFJLEtBQUssUUFBUSxDQUFDLElBQUksRUFBRSxDQUFDO2dCQUNyQyxXQUFXLEdBQUcsWUFBWSxDQUFDLGtCQUFrQixDQUFDLFdBQVcsQ0FBQyxDQUFDO1lBQy9ELENBQUM7WUFDRCxZQUFZLENBQUMsY0FBYyxDQUFDLFdBQVcsRUFBRSxhQUFhLENBQUMsQ0FBQztRQUM1RCxDQUFDO1FBQ0Qsa0VBQWtFO1FBQ2xFLE1BQU0sUUFBUSxHQUFHLGFBQWEsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSSxLQUFLLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUN4RSxJQUFJLFFBQVEsSUFBSSxRQUFRLENBQUMsTUFBTSxLQUFLLElBQUksRUFBRSxDQUFDO1lBQ3ZDLFFBQVEsQ0FBQyxHQUFHLElBQUksQ0FBQyxHQUFHLFFBQVEsQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDO1lBQzNDLFFBQVEsQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFDO1FBQzdCLENBQUM7UUFFRCxPQUFPLGFBQWEsQ0FBQztJQUN6QixDQUFDO0lBRUQscUVBQXFFO0lBQzdELE1BQU0sQ0FBQyxrQkFBa0IsQ0FBQyxXQUF5QjtRQUNuRCxXQUFXLENBQUMsTUFBTSxHQUFHLFdBQVcsQ0FBQyxNQUFNLENBQUMsTUFBTSxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUM7UUFDbEUsV0FBVyxDQUFDLEdBQUcsR0FBRyxXQUFXLENBQUMsS0FBSyxHQUFJLFdBQVcsQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDO1FBQ2pFLE9BQU8sRUFBRSxHQUFHLFdBQVcsRUFBRSxDQUFDO0lBQ2xDLENBQUM7SUFFTSxNQUFNLENBQUMsWUFBWSxDQUFDLEtBQVcsRUFBRSxZQUEwQixFQUFFLFVBQWtCO1FBQ2xGLElBQUksV0FBVyxDQUFDO1FBQ2hCLE1BQU0sUUFBUSxHQUFHLFlBQVksQ0FBQyxJQUFJLENBQUM7UUFDbkMsUUFBUSxRQUFRLEVBQUUsQ0FBQztZQUNmLEtBQUssUUFBUSxDQUFDLElBQUk7Z0JBQ2QsV0FBVyxHQUFHLEtBQUssQ0FBQyxPQUFPLEVBQUUsQ0FBQztnQkFDOUIsTUFBTTtZQUNWLEtBQUssUUFBUSxDQUFDLEtBQUs7Z0JBQ2Ysd0JBQXdCO2dCQUN4QixXQUFXLEdBQUcsS0FBSyxDQUFDLFFBQVEsRUFBRSxHQUFHLENBQUMsQ0FBQztnQkFDbkMsTUFBTTtZQUNWLEtBQUssUUFBUSxDQUFDLElBQUk7Z0JBQ2QsSUFBSSxVQUFVLEtBQUssQ0FBQyxFQUFFLENBQUM7b0JBQ25CLFdBQVcsR0FBRyxJQUFJLENBQUMsWUFBWSxDQUMzQixRQUFRLENBQUMsS0FBSyxDQUFDLFdBQVcsRUFBRSxDQUFDLFFBQVEsRUFBRSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxFQUFFLFVBQVUsRUFBRSxHQUFHLENBQUMsQ0FBQztnQkFDakYsQ0FBQztxQkFBTSxDQUFDO29CQUNKLFdBQVcsR0FBRyxLQUFLLENBQUMsV0FBVyxFQUFFLENBQUM7Z0JBQ3RDLENBQUM7Z0JBQ0QsTUFBTTtZQUNWLEtBQUssUUFBUSxDQUFDLEtBQUs7Z0JBQ2YsSUFBSSxZQUFZLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRSxDQUFDO29CQUMxQyxXQUFXLEdBQUcsSUFBSSxDQUFDLFlBQVksQ0FDM0IsSUFBSSxDQUFDLGtCQUFrQixDQUFDLEtBQUssQ0FBQyxRQUFRLEVBQUUsQ0FBQyxRQUFRLEVBQUUsQ0FBQyxFQUFFLFVBQVUsRUFBRSxHQUFHLENBQUMsQ0FBQztnQkFDL0UsQ0FBQztxQkFBTSxDQUFDO29CQUNKLFdBQVcsR0FBRyxLQUFLLENBQUMsUUFBUSxFQUFFLENBQUM7Z0JBQ25DLENBQUM7Z0JBQ0QsTUFBTTtZQUNWLEtBQUssUUFBUSxDQUFDLE9BQU87Z0JBQ2pCLFdBQVcsR0FBRyxLQUFLLENBQUMsVUFBVSxFQUFFLENBQUM7Z0JBQ2pDLE1BQU07WUFDVixLQUFLLFFBQVEsQ0FBQyxPQUFPO2dCQUNqQixXQUFXLEdBQUcsS0FBSyxDQUFDLFVBQVUsRUFBRSxDQUFDO2dCQUNqQyxNQUFNO1lBQ1YsS0FBSyxRQUFRLENBQUMsaUJBQWlCO2dCQUMzQixXQUFXLEdBQUcsS0FBSyxDQUFDLGVBQWUsRUFBRSxDQUFDO2dCQUN0QyxNQUFNO1lBQ1YsS0FBSyxRQUFRLENBQUMsSUFBSTtnQkFDZCxXQUFXLEdBQUcsWUFBWSxDQUFDLFlBQVksQ0FBQyxVQUFVLEVBQUUsS0FBSyxDQUFDLFFBQVEsRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDO2dCQUMzRSxNQUFNO1FBQ2QsQ0FBQztRQUVELElBQUksWUFBWSxDQUFDLElBQUksS0FBSyxRQUFRLENBQUMsSUFBSSxFQUFFLENBQUM7WUFDdEMsT0FBTyxJQUFJLENBQUMsWUFBWSxDQUFDLFdBQVcsRUFBRSxVQUFVLEVBQUUsR0FBRyxDQUFDLENBQUM7UUFDM0QsQ0FBQztRQUVELE9BQU8sV0FBVyxDQUFDO0lBQ3ZCLENBQUM7SUFFRDs7T0FFRztJQUNJLE1BQU0sQ0FBQyxZQUFZLENBQUMsVUFBa0IsRUFBRSxJQUFhO1FBQ3hELElBQUksSUFBSSxFQUFFLENBQUM7WUFDUCxPQUFPLFVBQVUsS0FBSyxDQUFDLENBQUMsQ0FBQyx3QkFBYyxDQUFDLHlCQUFjLENBQUM7UUFDM0QsQ0FBQzthQUFNLENBQUM7WUFDSixPQUFPLFVBQVUsS0FBSyxDQUFDLENBQUMsQ0FBQyx3QkFBYyxDQUFDLHlCQUFjLENBQUM7UUFDM0QsQ0FBQztJQUNMLENBQUM7SUFFRCw0REFBNEQ7SUFDckQsTUFBTSxDQUFDLElBQUksQ0FBQyxLQUFhO1FBQzVCLEtBQUssR0FBRyxLQUFLLENBQUMsV0FBVyxFQUFFLENBQUM7UUFDNUIsT0FBTyxDQUFDLEtBQUssS0FBSyx5QkFBYyxXQUFXLEVBQUUsSUFBSSxLQUFLLEtBQUssdUJBQWEsV0FBVyxFQUFFLENBQUMsQ0FBQztJQUMzRixDQUFDO0lBRUQsMkRBQTJEO0lBQ3BELE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBYTtRQUM1QixLQUFLLEdBQUcsS0FBSyxDQUFDLFdBQVcsRUFBRSxDQUFDO1FBQzVCLE9BQU8sQ0FBQyxLQUFLLEtBQUsseUJBQWMsV0FBVyxFQUFFLElBQUksS0FBSyxLQUFLLHVCQUFhLFdBQVcsRUFBRSxDQUFDLENBQUM7SUFDM0YsQ0FBQztJQUVELDBGQUEwRjtJQUNuRixNQUFNLENBQUMscUJBQXFCLENBQUMsTUFBYztRQUM5QyxNQUFNLEdBQUcsTUFBTSxJQUFJLFlBQVksQ0FBQyxjQUFjLENBQUM7UUFDL0MsSUFBSSxDQUFDLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxjQUFjLElBQUksQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDLFNBQVMsQ0FBQyxhQUFhLEVBQUUsQ0FBQztZQUNoRiwwQ0FBMEM7WUFDMUMsT0FBTyxZQUFZLENBQUMsb0JBQW9CLENBQUM7UUFDN0MsQ0FBQztRQUNELE1BQU0sS0FBSyxHQUFHLFlBQVksQ0FBQyxvQkFBb0IsQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUN4RCxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxFQUFFO1lBQ2QsSUFBSSxDQUFDLENBQUMsSUFBSSxLQUFLLFFBQVEsQ0FBQyxJQUFJLElBQUksQ0FBQyxDQUFDLElBQUksS0FBSyxZQUFZLENBQUMsU0FBUyxFQUFFLENBQUM7Z0JBQ2hFLENBQUMsQ0FBQyxVQUFVLHVDQUF1QixDQUFDO1lBQ3hDLENBQUM7UUFDTCxDQUFDLENBQUMsQ0FBQztRQUVILE9BQU8sWUFBWSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUN2QyxDQUFDO0lBRUQsbUhBQW1IO0lBQzVHLE1BQU0sQ0FBQyxVQUFVLENBQUMsS0FBb0IsRUFBRSxNQUFjLEVBQUUsTUFBYyxFQUFFLFFBQWlCO1FBQzVGLElBQUksYUFBcUIsQ0FBQztRQUMxQixJQUFJLENBQUM7WUFDRCxhQUFhLEdBQUcsVUFBVSxDQUFDLEtBQUssRUFBRSxNQUFNLEVBQUUsTUFBTSxFQUFFLFFBQVEsQ0FBQyxDQUFDO1FBQ2hFLENBQUM7UUFBQyxNQUFNLENBQUM7WUFDTCxZQUFZLENBQUMsd0JBQXdCLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDOUMsTUFBTSxTQUFTLEdBQUcsSUFBSSxJQUFJLENBQUMsY0FBYyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBQ2xELGFBQWEsR0FBRyxTQUFTLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQzVDLENBQUM7UUFFRCxPQUFPLGFBQWEsQ0FBQztJQUN6QixDQUFDO0lBRUQ7OztPQUdHO0lBQ0ksTUFBTSxDQUFDLG1CQUFtQixDQUFDLE1BQWMsRUFBRSxhQUFzQjtRQUNwRSxNQUFNLFVBQVUsR0FBRyxNQUFNLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBMEIsQ0FBQztRQUNyRSxNQUFNLFNBQVMsR0FBRyxVQUFVLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLFdBQVcsRUFBRSxLQUFLLGFBQWEsRUFBRSxXQUFXLEVBQUUsQ0FBQyxPQUFPLENBQUMsTUFBTSxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFDN0csSUFBSSxDQUFDLFNBQVMsRUFBRSxDQUFDO1lBQ2Isb0RBQW9EO1lBQ3BELGtDQUFrQztZQUNsQyxPQUFPLGFBQWEsQ0FBQztRQUN6QixDQUFDO1FBQ0QsSUFBSSxNQUFjLENBQUM7UUFDbkIsSUFBSSxDQUFDO1lBQ0QsTUFBTSxHQUFHLG1CQUFtQixDQUFDLE1BQU0sRUFBRSxXQUFXLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQztRQUNqRSxDQUFDO1FBQUMsTUFBTSxDQUFDO1lBQ0wsWUFBWSxDQUFDLHdCQUF3QixDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBQzlDLE1BQU0sR0FBRyxZQUFZLENBQUMscUJBQXFCLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDeEQsQ0FBQztRQUVELE9BQU8sTUFBTSxDQUFDO0lBQ2xCLENBQUM7SUFFRCw2REFBNkQ7SUFDdEQsTUFBTSxDQUFDLGdCQUFnQixDQUFDLElBQVk7UUFDdkMsT0FBTyxVQUFVLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxJQUFJLFVBQVUsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7SUFDOUUsQ0FBQztJQUVELG9EQUFvRDtJQUM3QyxNQUFNLENBQUMsUUFBUSxDQUFDLEtBQWEsRUFBRSxPQUFhLEVBQUUsUUFBaUI7UUFDbEUsTUFBTSxPQUFPLEdBQUcsWUFBWSxDQUFDLFdBQVcsQ0FBQyxPQUFPLENBQUMsV0FBVyxFQUFFLEVBQUUsT0FBTyxDQUFDLFFBQVEsRUFBRSxDQUFDLENBQUM7UUFDcEYsSUFBSSxJQUFJLEdBQUcsT0FBTyxDQUFDLE9BQU8sRUFBRSxHQUFHLEtBQUssQ0FBQztRQUNyQyxJQUFJLElBQUksR0FBRyxPQUFPLEVBQUUsQ0FBQztZQUNqQixJQUFJLEdBQUcsUUFBUSxDQUFDLENBQUMsQ0FBQyxJQUFJLEdBQUcsT0FBTyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUM7UUFDL0MsQ0FBQzthQUFNLElBQUksSUFBSSxHQUFHLENBQUMsRUFBRSxDQUFDO1lBQ2xCLElBQUksR0FBRyxRQUFRLENBQUMsQ0FBQyxDQUFDLE9BQU8sR0FBRyxDQUFDLElBQUksR0FBRyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ3JELENBQUM7UUFFRCxPQUFPLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQzFCLENBQUM7SUFFRCxxREFBcUQ7SUFDOUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxLQUFhLEVBQUUsT0FBYSxFQUFFLFFBQWlCO1FBQ25FLE1BQU0sT0FBTyxHQUFHLFlBQVksQ0FBQyxXQUFXLENBQUMsT0FBTyxDQUFDLFdBQVcsRUFBRSxFQUFFLE9BQU8sQ0FBQyxRQUFRLEVBQUUsR0FBRyxLQUFLLENBQUMsQ0FBQztRQUM1RixJQUFJLE9BQU8sQ0FBQyxPQUFPLEVBQUUsR0FBRyxPQUFPLEVBQUUsQ0FBQztZQUM5QixPQUFPLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQzdCLENBQUM7UUFFRCxNQUFNLFFBQVEsR0FBRyxFQUFFLENBQUM7UUFDcEIsTUFBTSxRQUFRLEdBQUcsQ0FBQyxDQUFDO1FBQ25CLElBQUksS0FBSyxHQUFHLE9BQU8sQ0FBQyxRQUFRLEVBQUUsR0FBRyxLQUFLLENBQUM7UUFDdkMsSUFBSSxLQUFLLEdBQUcsUUFBUSxFQUFFLENBQUM7WUFDbkIsS0FBSyxHQUFHLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLEdBQUcsUUFBUSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUM7UUFDekQsQ0FBQzthQUFNLElBQUksS0FBSyxHQUFHLFFBQVEsRUFBRSxDQUFDO1lBQzFCLEtBQUssR0FBRyxRQUFRLENBQUMsQ0FBQyxDQUFDLFFBQVEsR0FBRyxDQUFDLEtBQUssR0FBRyxRQUFRLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQztRQUNwRSxDQUFDO1FBRUQsT0FBTyxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUM1QixDQUFDO0lBRUQsb0RBQW9EO0lBQzdDLE1BQU0sQ0FBQyxRQUFRLENBQUMsS0FBYSxFQUFFLE9BQWE7UUFDL0MsTUFBTSxPQUFPLEdBQUcsWUFBWSxDQUFDLFdBQVcsQ0FBQyxPQUFPLENBQUMsV0FBVyxFQUFFLEdBQUcsS0FBSyxFQUFFLE9BQU8sQ0FBQyxRQUFRLEVBQUUsQ0FBQyxDQUFDO1FBQzVGLElBQUksT0FBTyxDQUFDLE9BQU8sRUFBRSxHQUFHLE9BQU8sRUFBRSxDQUFDO1lBQzlCLGtFQUFrRTtZQUNsRSxPQUFPLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQzdCLENBQUM7UUFDRCxPQUFPLENBQUMsV0FBVyxDQUFDLE9BQU8sQ0FBQyxXQUFXLEVBQUUsR0FBRyxLQUFLLENBQUMsQ0FBQztJQUN2RCxDQUFDO0lBRUQscURBQXFEO0lBQzlDLE1BQU0sQ0FBQyxTQUFTLENBQUMsS0FBYSxFQUFFLE9BQWEsRUFBRSxRQUFpQjtRQUNuRSxNQUFNLE9BQU8sR0FBRyxFQUFFLENBQUM7UUFDbkIsTUFBTSxPQUFPLEdBQUcsQ0FBQyxDQUFDO1FBQ2xCLElBQUksS0FBSyxHQUFHLE9BQU8sQ0FBQyxRQUFRLEVBQUUsR0FBRyxLQUFLLENBQUM7UUFDdkMsSUFBSSxLQUFLLEdBQUcsT0FBTyxFQUFFLENBQUM7WUFDbEIsS0FBSyxHQUFHLFFBQVEsQ0FBQyxDQUFDLENBQUMsS0FBSyxHQUFHLE9BQU8sR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQztRQUNyRCxDQUFDO2FBQU0sSUFBSSxLQUFLLEdBQUcsT0FBTyxFQUFFLENBQUM7WUFDekIsS0FBSyxHQUFHLFFBQVEsQ0FBQyxDQUFDLENBQUMsT0FBTyxHQUFHLENBQUMsS0FBSyxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDO1FBQ2pFLENBQUM7UUFFRCxPQUFPLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQzVCLENBQUM7SUFFRCx1REFBdUQ7SUFDaEQsTUFBTSxDQUFDLFdBQVcsQ0FBQyxLQUFhLEVBQUUsT0FBYSxFQUFFLFFBQWlCO1FBQ3JFLE1BQU0sVUFBVSxHQUFHLEVBQUUsQ0FBQztRQUN0QixNQUFNLFVBQVUsR0FBRyxDQUFDLENBQUM7UUFDckIsSUFBSSxPQUFPLEdBQUcsT0FBTyxDQUFDLFVBQVUsRUFBRSxHQUFHLEtBQUssQ0FBQztRQUMzQyxJQUFJLE9BQU8sR0FBRyxVQUFVLEVBQUUsQ0FBQztZQUN2QixPQUFPLEdBQUcsUUFBUSxDQUFDLENBQUMsQ0FBQyxPQUFPLEdBQUcsVUFBVSxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsVUFBVSxDQUFDO1FBQy9ELENBQUM7YUFBTSxJQUFJLE9BQU8sR0FBRyxVQUFVLEVBQUUsQ0FBQztZQUM5QixPQUFPLEdBQUcsUUFBUSxDQUFDLENBQUMsQ0FBQyxVQUFVLEdBQUcsQ0FBQyxPQUFPLEdBQUcsVUFBVSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxVQUFVLENBQUM7UUFDOUUsQ0FBQztRQUVELE9BQU8sQ0FBQyxVQUFVLENBQUMsT0FBTyxDQUFDLENBQUM7SUFDaEMsQ0FBQztJQUVELHVEQUF1RDtJQUNoRCxNQUFNLENBQUMsV0FBVyxDQUFDLEtBQWEsRUFBRSxPQUFhLEVBQUUsUUFBaUI7UUFDckUsTUFBTSxVQUFVLEdBQUcsRUFBRSxDQUFDO1FBQ3RCLE1BQU0sVUFBVSxHQUFHLENBQUMsQ0FBQztRQUNyQixJQUFJLE9BQU8sR0FBRyxPQUFPLENBQUMsVUFBVSxFQUFFLEdBQUcsS0FBSyxDQUFDO1FBQzNDLElBQUksT0FBTyxHQUFHLFVBQVUsRUFBRSxDQUFDO1lBQ3ZCLE9BQU8sR0FBRyxRQUFRLENBQUMsQ0FBQyxDQUFDLE9BQU8sR0FBRyxVQUFVLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxVQUFVLENBQUM7UUFDL0QsQ0FBQzthQUFNLElBQUksT0FBTyxHQUFHLFVBQVUsRUFBRSxDQUFDO1lBQzlCLE9BQU8sR0FBRyxRQUFRLENBQUMsQ0FBQyxDQUFDLFVBQVUsR0FBRyxDQUFDLE9BQU8sR0FBRyxVQUFVLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLFVBQVUsQ0FBQztRQUM5RSxDQUFDO1FBRUQsT0FBTyxDQUFDLFVBQVUsQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUNoQyxDQUFDO0lBRUEsaUZBQWlGO0lBQzNFLE1BQU0sQ0FBQyxxQkFBcUIsQ0FBQyxLQUFhLEVBQUUsT0FBYSxFQUFFLFFBQWlCO1FBQy9FLE1BQU0sS0FBSyxHQUFHLEdBQUcsQ0FBQztRQUNsQixNQUFNLEtBQUssR0FBRyxDQUFDLENBQUM7UUFDaEIsSUFBSSxFQUFFLEdBQUcsT0FBTyxDQUFDLGVBQWUsRUFBRSxHQUFHLEtBQUssQ0FBQztRQUMzQyxJQUFJLEVBQUUsR0FBRyxLQUFLLEVBQUUsQ0FBQztZQUNiLEVBQUUsR0FBRyxRQUFRLENBQUMsQ0FBQyxDQUFDLEVBQUUsR0FBRyxLQUFLLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUM7UUFDM0MsQ0FBQzthQUFNLElBQUksRUFBRSxHQUFHLEtBQUssRUFBRSxDQUFDO1lBQ3BCLEVBQUUsR0FBRyxRQUFRLENBQUMsQ0FBQyxDQUFDLEtBQUssR0FBRyxDQUFDLEVBQUUsR0FBRyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQztRQUNyRCxDQUFDO1FBRUQsT0FBTyxDQUFDLGVBQWUsQ0FBQyxFQUFFLENBQUMsQ0FBQztJQUNoQyxDQUFDO0lBRUQscURBQXFEO0lBQzlDLE1BQU0sQ0FBQyxRQUFRLENBQUMsT0FBYSxFQUFFLFdBQWlCLEVBQUUsWUFBb0I7UUFDekUsSUFBRyxZQUFZLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxFQUFFLENBQUM7WUFDakMsT0FBTyxHQUFHLElBQUksSUFBSSxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLFFBQVEsRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFDbEUsQ0FBQzthQUFNLElBQUcsWUFBWSxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsRUFBRSxDQUFDO1lBQ3hDLE9BQU8sR0FBRyxJQUFJLElBQUksQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxRQUFRLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBQ2xFLENBQUM7UUFFRCxJQUFJLE9BQU8sQ0FBQyxPQUFPLEVBQUUsS0FBSyxXQUFXLENBQUMsT0FBTyxFQUFFLEVBQUUsQ0FBQztZQUM5QyxPQUFPLFdBQVcsQ0FBQztRQUN2QixDQUFDO1FBRUQsT0FBTyxPQUFPLENBQUM7SUFDbkIsQ0FBQztJQUVEOzs7Ozs7T0FNRztJQUNJLE1BQU0sQ0FBQyxtQkFBbUIsQ0FBQyxLQUFXLEVBQUUsUUFBYyxFQUFFLFdBQVcsR0FBRyxJQUFJLEVBQUUsV0FBVyxHQUFHLElBQUk7UUFDakcsSUFBSSxXQUFXLElBQUksV0FBVyxFQUFFLENBQUM7WUFDN0IsT0FBTyxLQUFLLENBQUMsT0FBTyxFQUFFLEdBQUcsUUFBUSxDQUFDLE9BQU8sRUFBRSxDQUFDO1FBQ2hELENBQUM7UUFFRCxNQUFNLE1BQU0sR0FBRyxJQUFJLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQztRQUN6QyxNQUFNLFNBQVMsR0FBRyxJQUFJLElBQUksQ0FBQyxRQUFRLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQztRQUMvQyxJQUFJLENBQUMsV0FBVyxFQUFFLENBQUM7WUFDZixNQUFNLENBQUMsUUFBUSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO1lBQzVCLFNBQVMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFDbkMsQ0FBQztRQUNELElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQztZQUNmLE1BQU0sQ0FBQyxXQUFXLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztZQUM1QixTQUFTLENBQUMsV0FBVyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFDbkMsQ0FBQztRQUVELE9BQU8sTUFBTSxDQUFDLE9BQU8sRUFBRSxHQUFHLFNBQVMsQ0FBQyxPQUFPLEVBQUUsQ0FBQztJQUNsRCxDQUFDO0lBRUQ7Ozs7OztPQU1HO0lBQ0ksTUFBTSxDQUFDLGdCQUFnQixDQUFDLEtBQVcsRUFBRSxRQUFjLEVBQUUsV0FBVyxHQUFHLElBQUksRUFBRSxXQUFXLEdBQUcsSUFBSTtRQUM5RixJQUFJLFdBQVcsSUFBSSxXQUFXLEVBQUUsQ0FBQztZQUM3QixPQUFPLEtBQUssQ0FBQyxPQUFPLEVBQUUsR0FBRyxRQUFRLENBQUMsT0FBTyxFQUFFLENBQUM7UUFDaEQsQ0FBQztRQUVELE1BQU0sTUFBTSxHQUFHLElBQUksSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLEVBQUUsQ0FBQyxDQUFDO1FBQ3pDLE1BQU0sU0FBUyxHQUFHLElBQUksSUFBSSxDQUFDLFFBQVEsQ0FBQyxPQUFPLEVBQUUsQ0FBQyxDQUFDO1FBQy9DLElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQztZQUNmLE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7WUFDNUIsU0FBUyxDQUFDLFFBQVEsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztRQUNuQyxDQUFDO1FBQ0QsSUFBSSxDQUFDLFdBQVcsRUFBRSxDQUFDO1lBQ2YsTUFBTSxDQUFDLFdBQVcsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO1lBQzVCLFNBQVMsQ0FBQyxXQUFXLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztRQUNuQyxDQUFDO1FBRUQsT0FBTyxNQUFNLENBQUMsT0FBTyxFQUFFLEdBQUcsU0FBUyxDQUFDLE9BQU8sRUFBRSxDQUFDO0lBQ2xELENBQUM7SUFFRDs7Ozs7O09BTUc7SUFDSSxNQUFNLENBQUMsY0FBYyxDQUFDLEtBQVcsRUFBRSxRQUF1QixFQUFFLFFBQXVCLEVBQ3RGLFdBQVcsR0FBRyxJQUFJLEVBQUUsV0FBVyxHQUFHLElBQUk7UUFDdEMsSUFBSSxDQUFDLEtBQUssRUFBRSxDQUFDO1lBQ1QsT0FBTyxJQUFJLENBQUM7UUFDaEIsQ0FBQztRQUNELE1BQU0sTUFBTSxHQUFHLEVBQUUsQ0FBQztRQUNsQixNQUFNLEdBQUcsR0FBRyxZQUFZLENBQUMsV0FBVyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLFlBQVksQ0FBQyxZQUFZLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDaEcsTUFBTSxHQUFHLEdBQUcsWUFBWSxDQUFDLFdBQVcsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxZQUFZLENBQUMsWUFBWSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQ2hHLElBQUksR0FBRyxJQUFJLEtBQUssSUFBSSxZQUFZLENBQUMsZ0JBQWdCLENBQUMsS0FBSyxFQUFFLEdBQUcsRUFBRSxXQUFXLEVBQUUsV0FBVyxDQUFDLEVBQUUsQ0FBQztZQUN0RixNQUFNLENBQUMsTUFBTSxDQUFDLE1BQU0sRUFBRSxFQUFFLFFBQVEsRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDO1FBQzlDLENBQUM7UUFDRCxJQUFJLEdBQUcsSUFBSSxLQUFLLElBQUksWUFBWSxDQUFDLG1CQUFtQixDQUFDLEtBQUssRUFBRSxHQUFHLEVBQUUsV0FBVyxFQUFFLFdBQVcsQ0FBQyxFQUFFLENBQUM7WUFDekYsTUFBTSxDQUFDLE1BQU0sQ0FBQyxNQUFNLEVBQUUsRUFBRSxRQUFRLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQztRQUM5QyxDQUFDO1FBRUQsT0FBTyxNQUFNLENBQUM7SUFDbEIsQ0FBQztJQUVELG9DQUFvQztJQUM3QixNQUFNLENBQUMsWUFBWSxDQUFDLEtBQWE7UUFDcEMsSUFBSSxLQUFLLEdBQUcsU0FBUyxDQUFDO1FBQ3RCLE1BQU0sV0FBVyxHQUFHLEdBQUcsQ0FBQztRQUN4QixJQUFJLEtBQUssQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQztZQUNwQixPQUFPLElBQUksSUFBSSxDQUFDLEtBQUssR0FBRyxHQUFHLEtBQUssQ0FBQyxPQUFPLENBQUMsV0FBVyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQztRQUN2RixDQUFDO1FBRUQsS0FBSyxHQUFHLFNBQVMsQ0FBQztRQUNsQixJQUFJLEtBQUssQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQztZQUNwQixNQUFNLE9BQU8sR0FBRyxJQUFJLElBQUksRUFBRSxDQUFDLFdBQVcsRUFBRSxDQUFDO1lBQ3pDLHdDQUF3QztZQUN4QyxJQUFJLENBQUMsUUFBUSxFQUFFLFNBQVMsQ0FBQyxHQUFHLE9BQU8sQ0FBQyxLQUFLLENBQUMsV0FBVyxDQUFDLENBQUM7WUFDdkQsT0FBTyxJQUFJLElBQUksQ0FBQyxHQUFHLFFBQVEsSUFBSSxLQUFLLEVBQUUsQ0FBQyxDQUFDO1FBQzVDLENBQUM7UUFFRCxPQUFPLElBQUksQ0FBQztJQUNoQixDQUFDO0lBRUQ7Ozs7O09BS0c7SUFDSSxNQUFNLENBQUMsV0FBVyxDQUFDLEtBQVU7UUFDaEMsSUFBSSxNQUFNLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQztZQUNoQixPQUFPLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxPQUFPLEVBQUUsQ0FBQyxDQUFDO1FBQ25DLENBQUM7UUFFRCxPQUFPLEtBQUssQ0FBQztJQUNqQixDQUFDO0lBRU8sTUFBTSxDQUFDLGNBQWMsQ0FBQyxXQUF5QixFQUFFLGFBQTZCO1FBQ2xGLFlBQVksQ0FBQyxpQkFBaUIsQ0FBQyxXQUFXLENBQUMsQ0FBQztRQUM1QyxXQUFXLENBQUMsR0FBRyxHQUFHLFdBQVcsQ0FBQyxLQUFLLEdBQUcsV0FBVyxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUM7UUFDaEUsYUFBYSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQztJQUNwQyxDQUFDO0lBRU8sTUFBTSxDQUFDLFdBQVcsQ0FBQyxRQUFnQixFQUFFLEtBQWE7UUFDdEQsT0FBTyxJQUFJLElBQUksQ0FBQyxRQUFRLEVBQUUsS0FBSyxHQUFHLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxPQUFPLEVBQUUsQ0FBQztJQUN0RCxDQUFDO0lBRU8sTUFBTSxDQUFDLHFCQUFxQixDQUFDLEtBQWEsRUFBRSxVQUFtQjtRQUNuRSxNQUFNLE1BQU0sR0FBRyxLQUFLLENBQUMsT0FBTyxDQUFDLElBQUksTUFBTSxDQUFDLFVBQVUsSUFBSSxHQUFHLEVBQUUsR0FBRyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFDckUsT0FBTyxNQUFNLENBQUM7SUFDbEIsQ0FBQztJQUVPLE1BQU0sQ0FBQyxPQUFPLENBQUMsVUFBaUI7UUFDcEMsTUFBTSxJQUFJLEdBQUcsRUFBRSxDQUFDO1FBQ2hCLEtBQUssTUFBTSxJQUFJLElBQUksVUFBVSxFQUFFLENBQUM7WUFDNUIsUUFBUSxJQUFJLENBQUMsVUFBVSxFQUFFLENBQUM7Z0JBQ3RCLHVDQUF1QixDQUFDLENBQUMsQ0FBQztvQkFDdEIsSUFBSSxJQUFJLENBQUMsSUFBSSw4QkFBa0IsRUFBRSxDQUFDO3dCQUM5QixJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO29CQUNuQixDQUFDO3lCQUFNLElBQUksSUFBSSxDQUFDLElBQUksa0NBQW9CLEVBQUUsQ0FBQzt3QkFDdkMsSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztvQkFDbkIsQ0FBQzt5QkFBTSxDQUFDO3dCQUNKLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7b0JBQ3RCLENBQUM7b0JBQ0QsTUFBTTtnQkFDVixDQUFDO2dCQUNELHlDQUF5QixDQUFDLENBQUMsQ0FBQztvQkFDeEIsSUFBSSxJQUFJLENBQUMsSUFBSSw4QkFBa0IsRUFBRSxDQUFDO3dCQUM5QixJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO29CQUNwQixDQUFDO3lCQUFNLElBQUksSUFBSSxDQUFDLElBQUksa0NBQW9CLEVBQUUsQ0FBQzt3QkFDdkMsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztvQkFDcEIsQ0FBQzt5QkFBTSxDQUFDO3dCQUNKLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7b0JBQ3BCLENBQUM7Z0JBQ0wsQ0FBQztZQUNMLENBQUM7WUFFRCxJQUFJLElBQUksQ0FBQyxJQUFJLEtBQUssWUFBWSxDQUFDLFNBQVMsRUFBRSxDQUFDO2dCQUN2QyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUMxQixDQUFDO1FBQ0wsQ0FBQztRQUVELE9BQU8sSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQztJQUN6QixDQUFDO0lBRU8sTUFBTSxDQUFDLHdCQUF3QixDQUFDLE1BQWM7UUFDbEQsT0FBTyxDQUFDLElBQUksQ0FBQyxzQ0FBc0MsTUFBTSw0REFBNEQsQ0FBQyxDQUFDO1FBQ3ZILE9BQU8sQ0FBQyxJQUFJLENBQUMsd0NBQXdDLENBQUMsQ0FBQztJQUMzRCxDQUFDO0lBRU8sTUFBTSxDQUFDLFlBQVksQ0FBQyxLQUFhLEVBQUUsVUFBa0IsRUFBRSxXQUFtQjtRQUM5RSxPQUFPLENBQUMsV0FBVyxHQUFHLEtBQUssQ0FBQyxRQUFRLEVBQUUsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLFVBQVUsQ0FBQyxDQUFDO0lBQy9ELENBQUM7SUFFTyxNQUFNLENBQUMsa0JBQWtCLENBQUMsS0FBYSxFQUFFLFVBQVUsR0FBRyxHQUFHO1FBQzdELElBQUksSUFBSSxHQUFHLFFBQVEsQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLElBQUksTUFBTSxDQUFDLFVBQVUsRUFBRSxHQUFHLENBQUMsRUFBRSxHQUFHLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQztRQUN6RSxJQUFJLElBQUksR0FBRyxFQUFFLEVBQUUsQ0FBQztZQUNaLElBQUksSUFBSSxFQUFFLENBQUM7UUFDZixDQUFDO2FBQU0sSUFBSSxJQUFJLEtBQUssQ0FBQyxFQUFFLENBQUM7WUFDcEIsSUFBSSxHQUFHLEVBQUUsQ0FBQztRQUNkLENBQUM7UUFFRCxPQUFPLElBQUksQ0FBQztJQUNoQixDQUFDO0lBRU8sTUFBTSxDQUFDLGlCQUFpQixDQUFDLElBQWtCO1FBQy9DLFFBQVEsSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDO1lBQ2hCLEtBQUssUUFBUSxDQUFDLElBQUksQ0FBQztZQUNuQixLQUFLLFFBQVEsQ0FBQyxLQUFLLENBQUM7WUFDcEIsS0FBSyxRQUFRLENBQUMsS0FBSyxDQUFDO1lBQ3BCLEtBQUssUUFBUSxDQUFDLE9BQU8sQ0FBQztZQUN0QixLQUFLLFFBQVEsQ0FBQyxPQUFPO2dCQUNqQixJQUFJLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxLQUFLLENBQUMsRUFBRSxDQUFDO29CQUMzQixJQUFJLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUN4QyxDQUFDO2dCQUNELE1BQU07WUFDVixLQUFLLFFBQVEsQ0FBQyxpQkFBaUI7Z0JBQzNCLElBQUksQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQ3ZDLE1BQU07UUFDZCxDQUFDO0lBQ0wsQ0FBQztJQUVPLE1BQU0sQ0FBQyxXQUFXLENBQUMsU0FBaUIsRUFBRSxRQUFzQixFQUFFLFVBQW1CO1FBQ3JGLE9BQU8sWUFBWSxDQUFDLHFCQUFxQixDQUFDLFNBQVMsQ0FBQyxTQUFTLENBQUMsUUFBUSxDQUFDLEtBQUssRUFBRSxRQUFRLENBQUMsR0FBRyxDQUFDLEVBQUUsVUFBVSxDQUFDLENBQUM7SUFDN0csQ0FBQztJQUVPLE1BQU0sQ0FBQyxpQkFBaUIsQ0FBQyxJQUFZO1FBQ3pDLFFBQVEsSUFBSSxFQUFFLENBQUM7WUFDWCxLQUFLLEdBQUcsQ0FBQztZQUNULEtBQUssR0FBRztnQkFDSixPQUFPLFFBQVEsQ0FBQyxJQUFJLENBQUM7WUFDekIsS0FBSyxHQUFHO2dCQUNKLE9BQU8sUUFBUSxDQUFDLEtBQUssQ0FBQztZQUMxQixLQUFLLEdBQUcsQ0FBQztZQUNULEtBQUssR0FBRztnQkFDSixPQUFPLFFBQVEsQ0FBQyxJQUFJLENBQUM7WUFDekIsS0FBSyxHQUFHLENBQUM7WUFDVCxLQUFLLEdBQUc7Z0JBQ0osT0FBTyxRQUFRLENBQUMsS0FBSyxDQUFDO1lBQzFCLEtBQUssR0FBRztnQkFDSixPQUFPLFFBQVEsQ0FBQyxPQUFPLENBQUM7WUFDNUIsS0FBSyxHQUFHO2dCQUNKLE9BQU8sUUFBUSxDQUFDLE9BQU8sQ0FBQztZQUM1QixLQUFLLEdBQUc7Z0JBQ0osT0FBTyxRQUFRLENBQUMsaUJBQWlCLENBQUM7WUFDdEMsS0FBSyxHQUFHLENBQUM7WUFDVCxLQUFLLEdBQUcsQ0FBQztZQUNULEtBQUssR0FBRztnQkFDSixPQUFPLFFBQVEsQ0FBQyxJQUFJLENBQUM7WUFDekI7Z0JBQ0ksT0FBTyxRQUFRLENBQUMsT0FBTyxDQUFDO1FBQ2hDLENBQUM7SUFDTCxDQUFDO0lBRU8sTUFBTSxDQUFDLG9CQUFvQixDQUFDLE1BQWM7UUFDOUMsTUFBTSxVQUFVLEdBQUcsRUFBRSxDQUFDO1FBQ3RCLE1BQU0sU0FBUyxHQUFHLElBQUksSUFBSSxDQUFDLGNBQWMsQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUNsRCxNQUFNLGFBQWEsR0FBRyxTQUFTLENBQUMsYUFBYSxDQUFDLElBQUksSUFBSSxFQUFFLENBQUMsQ0FBQztRQUMxRCxLQUFLLE1BQU0sSUFBSSxJQUFJLGFBQWEsRUFBRSxDQUFDO1lBQy9CLElBQUksSUFBSSxDQUFDLElBQUksS0FBSyxZQUFZLENBQUMsU0FBUyxFQUFFLENBQUM7Z0JBQ3ZDLFVBQVUsQ0FBQyxJQUFJLENBQUM7b0JBQ1osSUFBSSxFQUFFLFlBQVksQ0FBQyxTQUFTO29CQUM1QixLQUFLLEVBQUUsSUFBSSxDQUFDLEtBQUs7aUJBQ3BCLENBQUMsQ0FBQztZQUNQLENBQUM7aUJBQU0sQ0FBQztnQkFDSixVQUFVLENBQUMsSUFBSSxDQUFDO29CQUNaLElBQUksRUFBRSxJQUFJLENBQUMsSUFBSTtpQkFDbEIsQ0FBQyxDQUFDO1lBQ1AsQ0FBQztRQUNMLENBQUM7UUFDRCxNQUFNLGdCQUFnQixHQUFHLFNBQVMsQ0FBQyxlQUFlLEVBQUUsQ0FBQztRQUNyRCxLQUFLLE1BQU0sSUFBSSxJQUFJLFVBQVUsRUFBRSxDQUFDO1lBQzVCLFFBQVEsSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDO2dCQUNoQiw4QkFBa0IsQ0FBQyxDQUFDLENBQUM7b0JBQ2pCLElBQUksQ0FBQyxVQUFVLEdBQUcsZ0JBQWdCLENBQUMsR0FBRyxDQUFDO29CQUN2QyxNQUFNO2dCQUNWLENBQUM7Z0JBQ0Qsa0NBQW9CLENBQUMsQ0FBQyxDQUFDO29CQUNuQixJQUFJLENBQUMsVUFBVSxHQUFHLGdCQUFnQixDQUFDLEtBQUssQ0FBQztvQkFDekMsTUFBTTtnQkFDVixDQUFDO2dCQUNELGdDQUFtQixDQUFDLENBQUMsQ0FBQztvQkFDbEIsSUFBSSxDQUFDLFVBQVUsR0FBRyxnQkFBZ0IsQ0FBQyxJQUFJLENBQUM7b0JBQ3hDLE1BQU07Z0JBQ1YsQ0FBQztZQUNMLENBQUM7UUFDTCxDQUFDO1FBQ0QsWUFBWSxDQUFDLHNCQUFzQixDQUFDLFVBQVUsQ0FBQyxDQUFDO1FBQ2hELE9BQU8sVUFBVSxDQUFDO0lBQ3RCLENBQUM7SUFFTyxNQUFNLENBQUMsc0JBQXNCLENBQUMsU0FBZ0I7UUFDbEQsSUFBSSxVQUFVLEdBQUcsQ0FBQyxDQUFDO1FBRW5CLEtBQUssTUFBTSxJQUFJLElBQUksU0FBUyxFQUFFLENBQUM7WUFDM0IsMkJBQTJCO1lBQzNCLElBQUksSUFBSSxDQUFDLElBQUksOEJBQWtCLElBQUksSUFBSSxDQUFDLElBQUksa0NBQW9CLEVBQUUsQ0FBQztnQkFDL0QsZ0NBQWdDO2dCQUNoQyxJQUFJLENBQUMsUUFBUSxHQUFHLENBQUMsVUFBVSxFQUFFLFVBQVUsR0FBRyxDQUFDLENBQUMsQ0FBQztnQkFDN0MsVUFBVSxJQUFJLENBQUMsQ0FBQztZQUNwQixDQUFDO2lCQUFNLElBQUksSUFBSSxDQUFDLElBQUksZ0NBQW1CLEVBQUUsQ0FBQztnQkFDdEMsc0JBQXNCO2dCQUN0QixRQUFRLElBQUksQ0FBQyxVQUFVLEVBQUUsQ0FBQztvQkFDdEIsdUNBQXVCLENBQUMsQ0FBQyxDQUFDO3dCQUN0QixtQ0FBbUM7d0JBQ25DLElBQUksQ0FBQyxRQUFRLEdBQUcsQ0FBQyxVQUFVLEVBQUUsVUFBVSxHQUFHLENBQUMsQ0FBQyxDQUFDO3dCQUM3QyxVQUFVLElBQUksQ0FBQyxDQUFDO3dCQUNoQixNQUFNO29CQUNWLENBQUM7b0JBQ0QseUNBQXlCLENBQUMsQ0FBQyxDQUFDO3dCQUN4QixvQ0FBb0M7d0JBQ3BDLElBQUksQ0FBQyxRQUFRLEdBQUcsQ0FBQyxVQUFVLEVBQUUsVUFBVSxHQUFHLENBQUMsQ0FBQyxDQUFDO3dCQUM3QyxVQUFVLElBQUksQ0FBQyxDQUFDO3dCQUNoQixNQUFNO29CQUNWLENBQUM7Z0JBQ0wsQ0FBQztZQUNMLENBQUM7aUJBQU0sSUFBSSxJQUFJLENBQUMsSUFBSSxLQUFLLFlBQVksQ0FBQyxTQUFTLEVBQUUsQ0FBQztnQkFDOUMsc0JBQXNCO2dCQUN0QixJQUFJLENBQUMsUUFBUSxHQUFHLENBQUMsVUFBVSxFQUFFLFVBQVUsR0FBRyxDQUFDLENBQUMsQ0FBQztnQkFDN0MsVUFBVSxFQUFFLENBQUM7WUFDakIsQ0FBQztRQUNMLENBQUM7SUFDTCxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRGF0ZVBhcnQsIERhdGVQYXJ0SW5mbyB9IGZyb20gJy4uLy4uL2RpcmVjdGl2ZXMvZGF0ZS10aW1lLWVkaXRvci9kYXRlLXRpbWUtZWRpdG9yLmNvbW1vbic7XG5pbXBvcnQgeyBmb3JtYXREYXRlLCBGb3JtYXRXaWR0aCwgZ2V0TG9jYWxlRGF0ZUZvcm1hdCB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbic7XG5pbXBvcnQgeyBWYWxpZGF0aW9uRXJyb3JzIH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xuaW1wb3J0IHsgaXNEYXRlIH0gZnJvbSAnLi4vLi4vY29yZS91dGlscyc7XG5cbi8qKiBAaGlkZGVuICovXG5jb25zdCBlbnVtIEZvcm1hdERlc2Mge1xuICAgIE51bWVyaWMgPSAnbnVtZXJpYycsXG4gICAgVHdvRGlnaXRzID0gJzItZGlnaXQnXG59XG5cbmNvbnN0IFRJTUVfQ0hBUlMgPSBbJ2gnLCAnSCcsICdtJywgJ3MnLCAnUycsICd0JywgJ1QnLCAnYSddO1xuY29uc3QgREFURV9DSEFSUyA9IFsnZCcsICdEJywgJ00nLCAneScsICdZJ107XG5cbi8qKiBAaGlkZGVuICovXG5jb25zdCBlbnVtIEFtUG1WYWx1ZXMge1xuICAgIEFNID0gJ0FNJyxcbiAgICBBID0gJ2EnLFxuICAgIFBNID0gJ1BNJyxcbiAgICBQID0gJ3AnXG59XG5cbi8qKiBAaGlkZGVuICovXG5jb25zdCBlbnVtIERhdGVQYXJ0cyB7XG4gICAgRGF5ID0gJ2RheScsXG4gICAgTW9udGggPSAnbW9udGgnLFxuICAgIFllYXIgPSAneWVhcidcbn1cblxuLyoqIEBoaWRkZW4gKi9cbmV4cG9ydCBhYnN0cmFjdCBjbGFzcyBEYXRlVGltZVV0aWwge1xuICAgIHB1YmxpYyBzdGF0aWMgcmVhZG9ubHkgREVGQVVMVF9JTlBVVF9GT1JNQVQgPSAnTU0vZGQveXl5eSc7XG4gICAgcHVibGljIHN0YXRpYyByZWFkb25seSBERUZBVUxUX1RJTUVfSU5QVVRfRk9STUFUID0gJ2hoOm1tIHR0JztcbiAgICBwcml2YXRlIHN0YXRpYyByZWFkb25seSBTRVBBUkFUT1IgPSAnbGl0ZXJhbCc7XG4gICAgcHJpdmF0ZSBzdGF0aWMgcmVhZG9ubHkgREVGQVVMVF9MT0NBTEUgPSAnZW4nO1xuXG4gICAgLyoqXG4gICAgICogUGFyc2UgYSBEYXRlIHZhbHVlIGZyb20gbWFza2VkIHN0cmluZyBpbnB1dCBiYXNlZCBvbiBkZXRlcm1pbmVkIGRhdGUgcGFydHNcbiAgICAgKlxuICAgICAqIEBwYXJhbSBpbnB1dERhdGEgbWFza2VkIHZhbHVlIHRvIHBhcnNlXG4gICAgICogQHBhcmFtIGRhdGVUaW1lUGFydHMgRGF0ZSBwYXJ0cyBhcnJheSBmb3IgdGhlIG1hc2tcbiAgICAgKi9cbiAgICBwdWJsaWMgc3RhdGljIHBhcnNlVmFsdWVGcm9tTWFzayhpbnB1dERhdGE6IHN0cmluZywgZGF0ZVRpbWVQYXJ0czogRGF0ZVBhcnRJbmZvW10sIHByb21wdENoYXI/OiBzdHJpbmcpOiBEYXRlIHwgbnVsbCB7XG4gICAgICAgIGNvbnN0IHBhcnRzOiB7IFtrZXkgaW4gRGF0ZVBhcnRdOiBudW1iZXIgfSA9IHt9IGFzIGFueTtcbiAgICAgICAgZGF0ZVRpbWVQYXJ0cy5mb3JFYWNoKGRwID0+IHtcbiAgICAgICAgICAgIGxldCB2YWx1ZSA9IHBhcnNlSW50KERhdGVUaW1lVXRpbC5nZXRDbGVhblZhbChpbnB1dERhdGEsIGRwLCBwcm9tcHRDaGFyKSwgMTApO1xuICAgICAgICAgICAgaWYgKCF2YWx1ZSkge1xuICAgICAgICAgICAgICAgIHZhbHVlID0gZHAudHlwZSA9PT0gRGF0ZVBhcnQuRGF0ZSB8fCBkcC50eXBlID09PSBEYXRlUGFydC5Nb250aCA/IDEgOiAwO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcGFydHNbZHAudHlwZV0gPSB2YWx1ZTtcbiAgICAgICAgfSk7XG4gICAgICAgIHBhcnRzW0RhdGVQYXJ0Lk1vbnRoXSAtPSAxO1xuXG4gICAgICAgIGlmIChwYXJ0c1tEYXRlUGFydC5Nb250aF0gPCAwIHx8IDExIDwgcGFydHNbRGF0ZVBhcnQuTW9udGhdKSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFRPRE86IENlbnR1cnkgdGhyZXNob2xkXG4gICAgICAgIGlmIChwYXJ0c1tEYXRlUGFydC5ZZWFyXSA8IDUwKSB7XG4gICAgICAgICAgICBwYXJ0c1tEYXRlUGFydC5ZZWFyXSArPSAyMDAwO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHBhcnRzW0RhdGVQYXJ0LkRhdGVdID4gRGF0ZVRpbWVVdGlsLmRheXNJbk1vbnRoKHBhcnRzW0RhdGVQYXJ0LlllYXJdLCBwYXJ0c1tEYXRlUGFydC5Nb250aF0pKSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChwYXJ0c1tEYXRlUGFydC5Ib3Vyc10gPiAyMyB8fCBwYXJ0c1tEYXRlUGFydC5NaW51dGVzXSA+IDU5XG4gICAgICAgICAgICB8fCBwYXJ0c1tEYXRlUGFydC5TZWNvbmRzXSA+IDU5IHx8IHBhcnRzW0RhdGVQYXJ0LkZyYWN0aW9uYWxTZWNvbmRzXSA+IDk5OSkge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBhbVBtID0gZGF0ZVRpbWVQYXJ0cy5maW5kKHAgPT4gcC50eXBlID09PSBEYXRlUGFydC5BbVBtKTtcbiAgICAgICAgaWYgKGFtUG0pIHtcbiAgICAgICAgICAgIHBhcnRzW0RhdGVQYXJ0LkhvdXJzXSAlPSAxMjtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChhbVBtKSB7XG4gICAgICAgICAgICBjb25zdCBjbGVhblZhbCA9IERhdGVUaW1lVXRpbC5nZXRDbGVhblZhbChpbnB1dERhdGEsIGFtUG0sIHByb21wdENoYXIpO1xuICAgICAgICAgICAgaWYgKERhdGVUaW1lVXRpbC5pc1BtKGNsZWFuVmFsKSkge1xuICAgICAgICAgICAgICAgIHBhcnRzW0RhdGVQYXJ0LkhvdXJzXSArPSAxMjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBuZXcgRGF0ZShcbiAgICAgICAgICAgIHBhcnRzW0RhdGVQYXJ0LlllYXJdIHx8IDIwMDAsXG4gICAgICAgICAgICBwYXJ0c1tEYXRlUGFydC5Nb250aF0gfHwgMCxcbiAgICAgICAgICAgIHBhcnRzW0RhdGVQYXJ0LkRhdGVdIHx8IDEsXG4gICAgICAgICAgICBwYXJ0c1tEYXRlUGFydC5Ib3Vyc10gfHwgMCxcbiAgICAgICAgICAgIHBhcnRzW0RhdGVQYXJ0Lk1pbnV0ZXNdIHx8IDAsXG4gICAgICAgICAgICBwYXJ0c1tEYXRlUGFydC5TZWNvbmRzXSB8fCAwLFxuICAgICAgICAgICAgcGFydHNbRGF0ZVBhcnQuRnJhY3Rpb25hbFNlY29uZHNdIHx8IDBcbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICAvKiogUGFyc2UgdGhlIG1hc2sgaW50byBkYXRlL3RpbWUgYW5kIGxpdGVyYWwgcGFydHMgKi9cbiAgICBwdWJsaWMgc3RhdGljIHBhcnNlRGF0ZVRpbWVGb3JtYXQobWFzazogc3RyaW5nLCBsb2NhbGU/OiBzdHJpbmcpOiBEYXRlUGFydEluZm9bXSB7XG4gICAgICAgIGNvbnN0IGZvcm1hdCA9IG1hc2sgfHwgRGF0ZVRpbWVVdGlsLmdldERlZmF1bHRJbnB1dEZvcm1hdChsb2NhbGUpO1xuICAgICAgICBjb25zdCBkYXRlVGltZVBhcnRzOiBEYXRlUGFydEluZm9bXSA9IFtdO1xuICAgICAgICBjb25zdCBmb3JtYXRBcnJheSA9IEFycmF5LmZyb20oZm9ybWF0KTtcbiAgICAgICAgbGV0IGN1cnJlbnRQYXJ0OiBEYXRlUGFydEluZm8gPSBudWxsO1xuICAgICAgICBsZXQgcG9zaXRpb24gPSAwO1xuICAgICAgICBsZXQgbGFzdFBhcnRBZGRlZCA9IGZhbHNlO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGZvcm1hdEFycmF5Lmxlbmd0aDsgaSsrLCBwb3NpdGlvbisrKSB7XG4gICAgICAgICAgICBjb25zdCB0eXBlID0gRGF0ZVRpbWVVdGlsLmRldGVybWluZURhdGVQYXJ0KGZvcm1hdEFycmF5W2ldKTtcbiAgICAgICAgICAgIGlmIChjdXJyZW50UGFydCkge1xuICAgICAgICAgICAgICAgIGlmIChjdXJyZW50UGFydC50eXBlID09PSB0eXBlKSB7XG4gICAgICAgICAgICAgICAgICAgIGN1cnJlbnRQYXJ0LmZvcm1hdCArPSBmb3JtYXRBcnJheVtpXTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGkgPCBmb3JtYXRBcnJheS5sZW5ndGggLSAxKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChjdXJyZW50UGFydC50eXBlID09PSBEYXRlUGFydC5BbVBtICYmIGN1cnJlbnRQYXJ0LmZvcm1hdC5pbmRleE9mKCdhJykgIT09IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgIGN1cnJlbnRQYXJ0ID0gRGF0ZVRpbWVVdGlsLnNpbXBsaWZ5QW1QbUZvcm1hdChjdXJyZW50UGFydCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIERhdGVUaW1lVXRpbC5hZGRDdXJyZW50UGFydChjdXJyZW50UGFydCwgZGF0ZVRpbWVQYXJ0cyk7XG4gICAgICAgICAgICAgICAgbGFzdFBhcnRBZGRlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgcG9zaXRpb24gPSBjdXJyZW50UGFydC5lbmQ7XG4gICAgICAgICAgICAgICAgaWYoaSA9PT0gZm9ybWF0QXJyYXkubGVuZ3RoIC0gMSAmJiBjdXJyZW50UGFydC50eXBlICE9PSB0eXBlKSB7XG4gICAgICAgICAgICAgICAgICAgIGxhc3RQYXJ0QWRkZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGN1cnJlbnRQYXJ0ID0ge1xuICAgICAgICAgICAgICAgIHN0YXJ0OiBwb3NpdGlvbixcbiAgICAgICAgICAgICAgICBlbmQ6IHBvc2l0aW9uICsgZm9ybWF0QXJyYXlbaV0ubGVuZ3RoLFxuICAgICAgICAgICAgICAgIHR5cGUsXG4gICAgICAgICAgICAgICAgZm9ybWF0OiBmb3JtYXRBcnJheVtpXVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIG1ha2Ugc3VyZSB0aGUgbGFzdCBtZW1iZXIgb2YgYSBmb3JtYXQgbGlrZSBIOm06cyBpcyBub3Qgb21pdHRlZFxuICAgICAgICBpZiAoIWxhc3RQYXJ0QWRkZWQpIHtcbiAgICAgICAgICAgIGlmIChjdXJyZW50UGFydC50eXBlID09PSBEYXRlUGFydC5BbVBtKSB7XG4gICAgICAgICAgICAgICAgY3VycmVudFBhcnQgPSBEYXRlVGltZVV0aWwuc2ltcGxpZnlBbVBtRm9ybWF0KGN1cnJlbnRQYXJ0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIERhdGVUaW1lVXRpbC5hZGRDdXJyZW50UGFydChjdXJyZW50UGFydCwgZGF0ZVRpbWVQYXJ0cyk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gZm9ybWF0cyBsaWtlIFwieVwiIG9yIFwieXl5XCIgYXJlIHRyZWF0ZWQgbGlrZSBcInl5eXlcIiB3aGlsZSBlZGl0aW5nXG4gICAgICAgIGNvbnN0IHllYXJQYXJ0ID0gZGF0ZVRpbWVQYXJ0cy5maWx0ZXIocCA9PiBwLnR5cGUgPT09IERhdGVQYXJ0LlllYXIpWzBdO1xuICAgICAgICBpZiAoeWVhclBhcnQgJiYgeWVhclBhcnQuZm9ybWF0ICE9PSAneXknKSB7XG4gICAgICAgICAgICB5ZWFyUGFydC5lbmQgKz0gNCAtIHllYXJQYXJ0LmZvcm1hdC5sZW5ndGg7XG4gICAgICAgICAgICB5ZWFyUGFydC5mb3JtYXQgPSAneXl5eSc7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gZGF0ZVRpbWVQYXJ0cztcbiAgICB9XG5cbiAgICAvKiogU2ltcGxpZmllcyB0aGUgQW1QbSBwYXJ0IHRvIGFzIG1hbnkgY2hhcnMgYXMgd2lsbCBiZSBkaXNwbGF5ZWQgKi9cbiAgICBwcml2YXRlIHN0YXRpYyBzaW1wbGlmeUFtUG1Gb3JtYXQoY3VycmVudFBhcnQ6IERhdGVQYXJ0SW5mbyl7XG4gICAgICAgICAgICBjdXJyZW50UGFydC5mb3JtYXQgPSBjdXJyZW50UGFydC5mb3JtYXQubGVuZ3RoID09PSA1ID8gJ2EnIDogJ2FhJztcbiAgICAgICAgICAgIGN1cnJlbnRQYXJ0LmVuZCA9IGN1cnJlbnRQYXJ0LnN0YXJ0ICsgIGN1cnJlbnRQYXJ0LmZvcm1hdC5sZW5ndGg7XG4gICAgICAgICAgICByZXR1cm4geyAuLi5jdXJyZW50UGFydCB9O1xuICAgIH1cblxuICAgIHB1YmxpYyBzdGF0aWMgZ2V0UGFydFZhbHVlKHZhbHVlOiBEYXRlLCBkYXRlUGFydEluZm86IERhdGVQYXJ0SW5mbywgcGFydExlbmd0aDogbnVtYmVyKTogc3RyaW5nIHtcbiAgICAgICAgbGV0IG1hc2tlZFZhbHVlO1xuICAgICAgICBjb25zdCBkYXRlUGFydCA9IGRhdGVQYXJ0SW5mby50eXBlO1xuICAgICAgICBzd2l0Y2ggKGRhdGVQYXJ0KSB7XG4gICAgICAgICAgICBjYXNlIERhdGVQYXJ0LkRhdGU6XG4gICAgICAgICAgICAgICAgbWFza2VkVmFsdWUgPSB2YWx1ZS5nZXREYXRlKCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIERhdGVQYXJ0Lk1vbnRoOlxuICAgICAgICAgICAgICAgIC8vIG1vbnRocyBhcmUgemVybyBiYXNlZFxuICAgICAgICAgICAgICAgIG1hc2tlZFZhbHVlID0gdmFsdWUuZ2V0TW9udGgoKSArIDE7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIERhdGVQYXJ0LlllYXI6XG4gICAgICAgICAgICAgICAgaWYgKHBhcnRMZW5ndGggPT09IDIpIHtcbiAgICAgICAgICAgICAgICAgICAgbWFza2VkVmFsdWUgPSB0aGlzLnByZXBlbmRWYWx1ZShcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlSW50KHZhbHVlLmdldEZ1bGxZZWFyKCkudG9TdHJpbmcoKS5zbGljZSgtMiksIDEwKSwgcGFydExlbmd0aCwgJzAnKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBtYXNrZWRWYWx1ZSA9IHZhbHVlLmdldEZ1bGxZZWFyKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBEYXRlUGFydC5Ib3VyczpcbiAgICAgICAgICAgICAgICBpZiAoZGF0ZVBhcnRJbmZvLmZvcm1hdC5pbmRleE9mKCdoJykgIT09IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgIG1hc2tlZFZhbHVlID0gdGhpcy5wcmVwZW5kVmFsdWUoXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnRvVHdlbHZlSG91ckZvcm1hdCh2YWx1ZS5nZXRIb3VycygpLnRvU3RyaW5nKCkpLCBwYXJ0TGVuZ3RoLCAnMCcpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIG1hc2tlZFZhbHVlID0gdmFsdWUuZ2V0SG91cnMoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIERhdGVQYXJ0Lk1pbnV0ZXM6XG4gICAgICAgICAgICAgICAgbWFza2VkVmFsdWUgPSB2YWx1ZS5nZXRNaW51dGVzKCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIERhdGVQYXJ0LlNlY29uZHM6XG4gICAgICAgICAgICAgICAgbWFza2VkVmFsdWUgPSB2YWx1ZS5nZXRTZWNvbmRzKCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIERhdGVQYXJ0LkZyYWN0aW9uYWxTZWNvbmRzOlxuICAgICAgICAgICAgICAgIG1hc2tlZFZhbHVlID0gdmFsdWUuZ2V0TWlsbGlzZWNvbmRzKCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIERhdGVQYXJ0LkFtUG06XG4gICAgICAgICAgICAgICAgbWFza2VkVmFsdWUgPSBEYXRlVGltZVV0aWwuZ2V0QW1QbVZhbHVlKHBhcnRMZW5ndGgsIHZhbHVlLmdldEhvdXJzKCkgPCAxMik7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZGF0ZVBhcnRJbmZvLnR5cGUgIT09IERhdGVQYXJ0LkFtUG0pIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnByZXBlbmRWYWx1ZShtYXNrZWRWYWx1ZSwgcGFydExlbmd0aCwgJzAnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBtYXNrZWRWYWx1ZTtcbiAgICB9XG5cbiAgICAvKiogUmV0dXJucyB0aGUgQW1QbSBwYXJ0IHZhbHVlIGRlcGVuZGluZyBvbiB0aGUgcGFydCBsZW5ndGggYW5kIGFcbiAgICAgKiBjb25kaXRpb25hbCBleHByZXNzaW9uIGluZGljYXRpbmcgd2hldGhlciB0aGUgdmFsdWUgaXMgQU0gb3IgUE0uXG4gICAgICovXG4gICAgcHVibGljIHN0YXRpYyBnZXRBbVBtVmFsdWUocGFydExlbmd0aDogbnVtYmVyLCBpc0FtOiBib29sZWFuKSB7XG4gICAgICAgIGlmIChpc0FtKSB7XG4gICAgICAgICAgICByZXR1cm4gcGFydExlbmd0aCA9PT0gMSA/IEFtUG1WYWx1ZXMuQSA6IEFtUG1WYWx1ZXMuQU07XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gcGFydExlbmd0aCA9PT0gMSA/IEFtUG1WYWx1ZXMuUCA6IEFtUG1WYWx1ZXMuUE07XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKiogUmV0dXJucyB0cnVlIGlmIGEgc3RyaW5nIHZhbHVlIGluZGljYXRlcyBhbiBBTSBwZXJpb2QgKi9cbiAgICBwdWJsaWMgc3RhdGljIGlzQW0odmFsdWU6IHN0cmluZykge1xuICAgICAgICB2YWx1ZSA9IHZhbHVlLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgIHJldHVybiAodmFsdWUgPT09IEFtUG1WYWx1ZXMuQU0udG9Mb3dlckNhc2UoKSB8fCB2YWx1ZSA9PT0gQW1QbVZhbHVlcy5BLnRvTG93ZXJDYXNlKCkpO1xuICAgIH1cblxuICAgIC8qKiBSZXR1cm5zIHRydWUgaWYgYSBzdHJpbmcgdmFsdWUgaW5kaWNhdGVzIGEgUE0gcGVyaW9kICovXG4gICAgcHVibGljIHN0YXRpYyBpc1BtKHZhbHVlOiBzdHJpbmcpIHtcbiAgICAgICAgdmFsdWUgPSB2YWx1ZS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICByZXR1cm4gKHZhbHVlID09PSBBbVBtVmFsdWVzLlBNLnRvTG93ZXJDYXNlKCkgfHwgdmFsdWUgPT09IEFtUG1WYWx1ZXMuUC50b0xvd2VyQ2FzZSgpKTtcbiAgICB9XG5cbiAgICAvKiogQnVpbGRzIGEgZGF0ZS10aW1lIGVkaXRvcidzIGRlZmF1bHQgaW5wdXQgZm9ybWF0IGJhc2VkIG9uIHByb3ZpZGVkIGxvY2FsZSBzZXR0aW5ncy4gKi9cbiAgICBwdWJsaWMgc3RhdGljIGdldERlZmF1bHRJbnB1dEZvcm1hdChsb2NhbGU6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgICAgIGxvY2FsZSA9IGxvY2FsZSB8fCBEYXRlVGltZVV0aWwuREVGQVVMVF9MT0NBTEU7XG4gICAgICAgIGlmICghSW50bCB8fCAhSW50bC5EYXRlVGltZUZvcm1hdCB8fCAhSW50bC5EYXRlVGltZUZvcm1hdC5wcm90b3R5cGUuZm9ybWF0VG9QYXJ0cykge1xuICAgICAgICAgICAgLy8gVE9ETzogZmFsbGJhY2sgd2l0aCBJbnRsLmZvcm1hdCBmb3IgSUU/XG4gICAgICAgICAgICByZXR1cm4gRGF0ZVRpbWVVdGlsLkRFRkFVTFRfSU5QVVRfRk9STUFUO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHBhcnRzID0gRGF0ZVRpbWVVdGlsLmdldERlZmF1bHRMb2NhbGVNYXNrKGxvY2FsZSk7XG4gICAgICAgIHBhcnRzLmZvckVhY2gocCA9PiB7XG4gICAgICAgICAgICBpZiAocC50eXBlICE9PSBEYXRlUGFydC5ZZWFyICYmIHAudHlwZSAhPT0gRGF0ZVRpbWVVdGlsLlNFUEFSQVRPUikge1xuICAgICAgICAgICAgICAgIHAuZm9ybWF0VHlwZSA9IEZvcm1hdERlc2MuVHdvRGlnaXRzO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4gRGF0ZVRpbWVVdGlsLmdldE1hc2socGFydHMpO1xuICAgIH1cblxuICAgIC8qKiBUcmllcyB0byBmb3JtYXQgYSBkYXRlIHVzaW5nIEFuZ3VsYXIncyBEYXRlUGlwZS4gRmFsbGJhY2tzIHRvIGBJbnRsYCBpZiBubyBsb2NhbGUgc2V0dGluZ3MgaGF2ZSBiZWVuIGxvYWRlZC4gKi9cbiAgICBwdWJsaWMgc3RhdGljIGZvcm1hdERhdGUodmFsdWU6IG51bWJlciB8IERhdGUsIGZvcm1hdDogc3RyaW5nLCBsb2NhbGU6IHN0cmluZywgdGltZXpvbmU/OiBzdHJpbmcpOiBzdHJpbmcge1xuICAgICAgICBsZXQgZm9ybWF0dGVkRGF0ZTogc3RyaW5nO1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgZm9ybWF0dGVkRGF0ZSA9IGZvcm1hdERhdGUodmFsdWUsIGZvcm1hdCwgbG9jYWxlLCB0aW1lem9uZSk7XG4gICAgICAgIH0gY2F0Y2gge1xuICAgICAgICAgICAgRGF0ZVRpbWVVdGlsLmxvZ01pc3NpbmdMb2NhbGVTZXR0aW5ncyhsb2NhbGUpO1xuICAgICAgICAgICAgY29uc3QgZm9ybWF0dGVyID0gbmV3IEludGwuRGF0ZVRpbWVGb3JtYXQobG9jYWxlKTtcbiAgICAgICAgICAgIGZvcm1hdHRlZERhdGUgPSBmb3JtYXR0ZXIuZm9ybWF0KHZhbHVlKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBmb3JtYXR0ZWREYXRlO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJldHVybnMgdGhlIGRhdGUgZm9ybWF0IGJhc2VkIG9uIGEgcHJvdmlkZWQgbG9jYWxlLlxuICAgICAqIFN1cHBvcnRzIEFuZ3VsYXIncyBEYXRlUGlwZSBmb3JtYXQgb3B0aW9ucyBzdWNoIGFzIGBzaG9ydERhdGVgLCBgbG9uZ0RhdGVgLlxuICAgICAqL1xuICAgIHB1YmxpYyBzdGF0aWMgZ2V0TG9jYWxlRGF0ZUZvcm1hdChsb2NhbGU6IHN0cmluZywgZGlzcGxheUZvcm1hdD86IHN0cmluZyk6IHN0cmluZyB7XG4gICAgICAgIGNvbnN0IGZvcm1hdEtleXMgPSBPYmplY3Qua2V5cyhGb3JtYXRXaWR0aCkgYXMgKGtleW9mIEZvcm1hdFdpZHRoKVtdO1xuICAgICAgICBjb25zdCB0YXJnZXRLZXkgPSBmb3JtYXRLZXlzLmZpbmQoayA9PiBrLnRvTG93ZXJDYXNlKCkgPT09IGRpc3BsYXlGb3JtYXQ/LnRvTG93ZXJDYXNlKCkucmVwbGFjZSgnZGF0ZScsICcnKSk7XG4gICAgICAgIGlmICghdGFyZ2V0S2V5KSB7XG4gICAgICAgICAgICAvLyBpZiBkaXNwbGF5Rm9ybWF0IGlzIG5vdCBzaG9ydERhdGUsIGxvbmdEYXRlLCBldGMuXG4gICAgICAgICAgICAvLyBvciBpZiBpdCBpcyBub3Qgc2V0IGJ5IHRoZSB1c2VyXG4gICAgICAgICAgICByZXR1cm4gZGlzcGxheUZvcm1hdDtcbiAgICAgICAgfVxuICAgICAgICBsZXQgZm9ybWF0OiBzdHJpbmc7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBmb3JtYXQgPSBnZXRMb2NhbGVEYXRlRm9ybWF0KGxvY2FsZSwgRm9ybWF0V2lkdGhbdGFyZ2V0S2V5XSk7XG4gICAgICAgIH0gY2F0Y2gge1xuICAgICAgICAgICAgRGF0ZVRpbWVVdGlsLmxvZ01pc3NpbmdMb2NhbGVTZXR0aW5ncyhsb2NhbGUpO1xuICAgICAgICAgICAgZm9ybWF0ID0gRGF0ZVRpbWVVdGlsLmdldERlZmF1bHRJbnB1dEZvcm1hdChsb2NhbGUpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGZvcm1hdDtcbiAgICB9XG5cbiAgICAvKiogRGV0ZXJtaW5lcyBpZiBhIGdpdmVuIGNoYXJhY3RlciBpcyBgZC9NL3lgIG9yIGBoL20vc2AuICovXG4gICAgcHVibGljIHN0YXRpYyBpc0RhdGVPclRpbWVDaGFyKGNoYXI6IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gREFURV9DSEFSUy5pbmRleE9mKGNoYXIpICE9PSAtMSB8fCBUSU1FX0NIQVJTLmluZGV4T2YoY2hhcikgIT09IC0xO1xuICAgIH1cblxuICAgIC8qKiBTcGlucyB0aGUgZGF0ZSBwb3J0aW9uIGluIGEgZGF0ZS10aW1lIGVkaXRvci4gKi9cbiAgICBwdWJsaWMgc3RhdGljIHNwaW5EYXRlKGRlbHRhOiBudW1iZXIsIG5ld0RhdGU6IERhdGUsIHNwaW5Mb29wOiBib29sZWFuKTogdm9pZCB7XG4gICAgICAgIGNvbnN0IG1heERhdGUgPSBEYXRlVGltZVV0aWwuZGF5c0luTW9udGgobmV3RGF0ZS5nZXRGdWxsWWVhcigpLCBuZXdEYXRlLmdldE1vbnRoKCkpO1xuICAgICAgICBsZXQgZGF0ZSA9IG5ld0RhdGUuZ2V0RGF0ZSgpICsgZGVsdGE7XG4gICAgICAgIGlmIChkYXRlID4gbWF4RGF0ZSkge1xuICAgICAgICAgICAgZGF0ZSA9IHNwaW5Mb29wID8gZGF0ZSAlIG1heERhdGUgOiBtYXhEYXRlO1xuICAgICAgICB9IGVsc2UgaWYgKGRhdGUgPCAxKSB7XG4gICAgICAgICAgICBkYXRlID0gc3Bpbkxvb3AgPyBtYXhEYXRlICsgKGRhdGUgJSBtYXhEYXRlKSA6IDE7XG4gICAgICAgIH1cblxuICAgICAgICBuZXdEYXRlLnNldERhdGUoZGF0ZSk7XG4gICAgfVxuXG4gICAgLyoqIFNwaW5zIHRoZSBtb250aCBwb3J0aW9uIGluIGEgZGF0ZS10aW1lIGVkaXRvci4gKi9cbiAgICBwdWJsaWMgc3RhdGljIHNwaW5Nb250aChkZWx0YTogbnVtYmVyLCBuZXdEYXRlOiBEYXRlLCBzcGluTG9vcDogYm9vbGVhbik6IHZvaWQge1xuICAgICAgICBjb25zdCBtYXhEYXRlID0gRGF0ZVRpbWVVdGlsLmRheXNJbk1vbnRoKG5ld0RhdGUuZ2V0RnVsbFllYXIoKSwgbmV3RGF0ZS5nZXRNb250aCgpICsgZGVsdGEpO1xuICAgICAgICBpZiAobmV3RGF0ZS5nZXREYXRlKCkgPiBtYXhEYXRlKSB7XG4gICAgICAgICAgICBuZXdEYXRlLnNldERhdGUobWF4RGF0ZSk7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBtYXhNb250aCA9IDExO1xuICAgICAgICBjb25zdCBtaW5Nb250aCA9IDA7XG4gICAgICAgIGxldCBtb250aCA9IG5ld0RhdGUuZ2V0TW9udGgoKSArIGRlbHRhO1xuICAgICAgICBpZiAobW9udGggPiBtYXhNb250aCkge1xuICAgICAgICAgICAgbW9udGggPSBzcGluTG9vcCA/IChtb250aCAlIG1heE1vbnRoKSAtIDEgOiBtYXhNb250aDtcbiAgICAgICAgfSBlbHNlIGlmIChtb250aCA8IG1pbk1vbnRoKSB7XG4gICAgICAgICAgICBtb250aCA9IHNwaW5Mb29wID8gbWF4TW9udGggKyAobW9udGggJSBtYXhNb250aCkgKyAxIDogbWluTW9udGg7XG4gICAgICAgIH1cblxuICAgICAgICBuZXdEYXRlLnNldE1vbnRoKG1vbnRoKTtcbiAgICB9XG5cbiAgICAvKiogU3BpbnMgdGhlIHllYXIgcG9ydGlvbiBpbiBhIGRhdGUtdGltZSBlZGl0b3IuICovXG4gICAgcHVibGljIHN0YXRpYyBzcGluWWVhcihkZWx0YTogbnVtYmVyLCBuZXdEYXRlOiBEYXRlKTogdm9pZCB7XG4gICAgICAgIGNvbnN0IG1heERhdGUgPSBEYXRlVGltZVV0aWwuZGF5c0luTW9udGgobmV3RGF0ZS5nZXRGdWxsWWVhcigpICsgZGVsdGEsIG5ld0RhdGUuZ2V0TW9udGgoKSk7XG4gICAgICAgIGlmIChuZXdEYXRlLmdldERhdGUoKSA+IG1heERhdGUpIHtcbiAgICAgICAgICAgIC8vIGNsaXAgdG8gbWF4IHRvIGF2b2lkIGxlYXAgeWVhciBjaGFuZ2Ugc2hpZnRpbmcgdGhlIGVudGlyZSB2YWx1ZVxuICAgICAgICAgICAgbmV3RGF0ZS5zZXREYXRlKG1heERhdGUpO1xuICAgICAgICB9XG4gICAgICAgIG5ld0RhdGUuc2V0RnVsbFllYXIobmV3RGF0ZS5nZXRGdWxsWWVhcigpICsgZGVsdGEpO1xuICAgIH1cblxuICAgIC8qKiBTcGlucyB0aGUgaG91cnMgcG9ydGlvbiBpbiBhIGRhdGUtdGltZSBlZGl0b3IuICovXG4gICAgcHVibGljIHN0YXRpYyBzcGluSG91cnMoZGVsdGE6IG51bWJlciwgbmV3RGF0ZTogRGF0ZSwgc3Bpbkxvb3A6IGJvb2xlYW4pOiB2b2lkIHtcbiAgICAgICAgY29uc3QgbWF4SG91ciA9IDIzO1xuICAgICAgICBjb25zdCBtaW5Ib3VyID0gMDtcbiAgICAgICAgbGV0IGhvdXJzID0gbmV3RGF0ZS5nZXRIb3VycygpICsgZGVsdGE7XG4gICAgICAgIGlmIChob3VycyA+IG1heEhvdXIpIHtcbiAgICAgICAgICAgIGhvdXJzID0gc3Bpbkxvb3AgPyBob3VycyAlIG1heEhvdXIgLSAxIDogbWF4SG91cjtcbiAgICAgICAgfSBlbHNlIGlmIChob3VycyA8IG1pbkhvdXIpIHtcbiAgICAgICAgICAgIGhvdXJzID0gc3Bpbkxvb3AgPyBtYXhIb3VyICsgKGhvdXJzICUgbWF4SG91cikgKyAxIDogbWluSG91cjtcbiAgICAgICAgfVxuXG4gICAgICAgIG5ld0RhdGUuc2V0SG91cnMoaG91cnMpO1xuICAgIH1cblxuICAgIC8qKiBTcGlucyB0aGUgbWludXRlcyBwb3J0aW9uIGluIGEgZGF0ZS10aW1lIGVkaXRvci4gKi9cbiAgICBwdWJsaWMgc3RhdGljIHNwaW5NaW51dGVzKGRlbHRhOiBudW1iZXIsIG5ld0RhdGU6IERhdGUsIHNwaW5Mb29wOiBib29sZWFuKTogdm9pZCB7XG4gICAgICAgIGNvbnN0IG1heE1pbnV0ZXMgPSA1OTtcbiAgICAgICAgY29uc3QgbWluTWludXRlcyA9IDA7XG4gICAgICAgIGxldCBtaW51dGVzID0gbmV3RGF0ZS5nZXRNaW51dGVzKCkgKyBkZWx0YTtcbiAgICAgICAgaWYgKG1pbnV0ZXMgPiBtYXhNaW51dGVzKSB7XG4gICAgICAgICAgICBtaW51dGVzID0gc3Bpbkxvb3AgPyBtaW51dGVzICUgbWF4TWludXRlcyAtIDEgOiBtYXhNaW51dGVzO1xuICAgICAgICB9IGVsc2UgaWYgKG1pbnV0ZXMgPCBtaW5NaW51dGVzKSB7XG4gICAgICAgICAgICBtaW51dGVzID0gc3Bpbkxvb3AgPyBtYXhNaW51dGVzICsgKG1pbnV0ZXMgJSBtYXhNaW51dGVzKSArIDEgOiBtaW5NaW51dGVzO1xuICAgICAgICB9XG5cbiAgICAgICAgbmV3RGF0ZS5zZXRNaW51dGVzKG1pbnV0ZXMpO1xuICAgIH1cblxuICAgIC8qKiBTcGlucyB0aGUgc2Vjb25kcyBwb3J0aW9uIGluIGEgZGF0ZS10aW1lIGVkaXRvci4gKi9cbiAgICBwdWJsaWMgc3RhdGljIHNwaW5TZWNvbmRzKGRlbHRhOiBudW1iZXIsIG5ld0RhdGU6IERhdGUsIHNwaW5Mb29wOiBib29sZWFuKTogdm9pZCB7XG4gICAgICAgIGNvbnN0IG1heFNlY29uZHMgPSA1OTtcbiAgICAgICAgY29uc3QgbWluU2Vjb25kcyA9IDA7XG4gICAgICAgIGxldCBzZWNvbmRzID0gbmV3RGF0ZS5nZXRTZWNvbmRzKCkgKyBkZWx0YTtcbiAgICAgICAgaWYgKHNlY29uZHMgPiBtYXhTZWNvbmRzKSB7XG4gICAgICAgICAgICBzZWNvbmRzID0gc3Bpbkxvb3AgPyBzZWNvbmRzICUgbWF4U2Vjb25kcyAtIDEgOiBtYXhTZWNvbmRzO1xuICAgICAgICB9IGVsc2UgaWYgKHNlY29uZHMgPCBtaW5TZWNvbmRzKSB7XG4gICAgICAgICAgICBzZWNvbmRzID0gc3Bpbkxvb3AgPyBtYXhTZWNvbmRzICsgKHNlY29uZHMgJSBtYXhTZWNvbmRzKSArIDEgOiBtaW5TZWNvbmRzO1xuICAgICAgICB9XG5cbiAgICAgICAgbmV3RGF0ZS5zZXRTZWNvbmRzKHNlY29uZHMpO1xuICAgIH1cblxuICAgICAvKiogU3BpbnMgdGhlIGZyYWN0aW9uYWwgc2Vjb25kcyAobWlsbGlzZWNvbmRzKSBwb3J0aW9uIGluIGEgZGF0ZS10aW1lIGVkaXRvci4gKi9cbiAgICBwdWJsaWMgc3RhdGljIHNwaW5GcmFjdGlvbmFsU2Vjb25kcyhkZWx0YTogbnVtYmVyLCBuZXdEYXRlOiBEYXRlLCBzcGluTG9vcDogYm9vbGVhbikge1xuICAgICAgICBjb25zdCBtYXhNcyA9IDk5OTtcbiAgICAgICAgY29uc3QgbWluTXMgPSAwO1xuICAgICAgICBsZXQgbXMgPSBuZXdEYXRlLmdldE1pbGxpc2Vjb25kcygpICsgZGVsdGE7XG4gICAgICAgIGlmIChtcyA+IG1heE1zKSB7XG4gICAgICAgICAgICBtcyA9IHNwaW5Mb29wID8gbXMgJSBtYXhNcyAtIDEgOiBtYXhNcztcbiAgICAgICAgfSBlbHNlIGlmIChtcyA8IG1pbk1zKSB7XG4gICAgICAgICAgICBtcyA9IHNwaW5Mb29wID8gbWF4TXMgKyAobXMgJSBtYXhNcykgKyAxIDogbWluTXM7XG4gICAgICAgIH1cblxuICAgICAgICBuZXdEYXRlLnNldE1pbGxpc2Vjb25kcyhtcyk7XG4gICAgfVxuXG4gICAgLyoqIFNwaW5zIHRoZSBBTS9QTSBwb3J0aW9uIGluIGEgZGF0ZS10aW1lIGVkaXRvci4gKi9cbiAgICBwdWJsaWMgc3RhdGljIHNwaW5BbVBtKG5ld0RhdGU6IERhdGUsIGN1cnJlbnREYXRlOiBEYXRlLCBhbVBtRnJvbU1hc2s6IHN0cmluZyk6IERhdGUge1xuICAgICAgICBpZihEYXRlVGltZVV0aWwuaXNBbShhbVBtRnJvbU1hc2spKSB7XG4gICAgICAgICAgICBuZXdEYXRlID0gbmV3IERhdGUobmV3RGF0ZS5zZXRIb3VycyhuZXdEYXRlLmdldEhvdXJzKCkgKyAxMikpO1xuICAgICAgICB9IGVsc2UgaWYoRGF0ZVRpbWVVdGlsLmlzUG0oYW1QbUZyb21NYXNrKSkge1xuICAgICAgICAgICAgbmV3RGF0ZSA9IG5ldyBEYXRlKG5ld0RhdGUuc2V0SG91cnMobmV3RGF0ZS5nZXRIb3VycygpIC0gMTIpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChuZXdEYXRlLmdldERhdGUoKSAhPT0gY3VycmVudERhdGUuZ2V0RGF0ZSgpKSB7XG4gICAgICAgICAgICByZXR1cm4gY3VycmVudERhdGU7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gbmV3RGF0ZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBEZXRlcm1pbmVzIHdoZXRoZXIgdGhlIHByb3ZpZGVkIHZhbHVlIGlzIGdyZWF0ZXIgdGhhbiB0aGUgcHJvdmlkZWQgbWF4IHZhbHVlLlxuICAgICAqXG4gICAgICogQHBhcmFtIGluY2x1ZGVUaW1lIHNldCB0byBmYWxzZSBpZiB5b3Ugd2FudCB0byBleGNsdWRlIHRpbWUgcG9ydGlvbiBvZiB0aGUgdHdvIGRhdGVzXG4gICAgICogQHBhcmFtIGluY2x1ZGVEYXRlIHNldCB0byBmYWxzZSBpZiB5b3Ugd2FudCB0byBleGNsdWRlIHRoZSBkYXRlIHBvcnRpb24gb2YgdGhlIHR3byBkYXRlc1xuICAgICAqIEByZXR1cm5zIHRydWUgaWYgcHJvdmlkZWQgdmFsdWUgaXMgZ3JlYXRlciB0aGFuIHByb3ZpZGVkIG1heFZhbHVlXG4gICAgICovXG4gICAgcHVibGljIHN0YXRpYyBncmVhdGVyVGhhbk1heFZhbHVlKHZhbHVlOiBEYXRlLCBtYXhWYWx1ZTogRGF0ZSwgaW5jbHVkZVRpbWUgPSB0cnVlLCBpbmNsdWRlRGF0ZSA9IHRydWUpOiBib29sZWFuIHtcbiAgICAgICAgaWYgKGluY2x1ZGVUaW1lICYmIGluY2x1ZGVEYXRlKSB7XG4gICAgICAgICAgICByZXR1cm4gdmFsdWUuZ2V0VGltZSgpID4gbWF4VmFsdWUuZ2V0VGltZSgpO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgX3ZhbHVlID0gbmV3IERhdGUodmFsdWUuZ2V0VGltZSgpKTtcbiAgICAgICAgY29uc3QgX21heFZhbHVlID0gbmV3IERhdGUobWF4VmFsdWUuZ2V0VGltZSgpKTtcbiAgICAgICAgaWYgKCFpbmNsdWRlVGltZSkge1xuICAgICAgICAgICAgX3ZhbHVlLnNldEhvdXJzKDAsIDAsIDAsIDApO1xuICAgICAgICAgICAgX21heFZhbHVlLnNldEhvdXJzKDAsIDAsIDAsIDApO1xuICAgICAgICB9XG4gICAgICAgIGlmICghaW5jbHVkZURhdGUpIHtcbiAgICAgICAgICAgIF92YWx1ZS5zZXRGdWxsWWVhcigwLCAwLCAwKTtcbiAgICAgICAgICAgIF9tYXhWYWx1ZS5zZXRGdWxsWWVhcigwLCAwLCAwKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBfdmFsdWUuZ2V0VGltZSgpID4gX21heFZhbHVlLmdldFRpbWUoKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBEZXRlcm1pbmVzIHdoZXRoZXIgdGhlIHByb3ZpZGVkIHZhbHVlIGlzIGxlc3MgdGhhbiB0aGUgcHJvdmlkZWQgbWluIHZhbHVlLlxuICAgICAqXG4gICAgICogQHBhcmFtIGluY2x1ZGVUaW1lIHNldCB0byBmYWxzZSBpZiB5b3Ugd2FudCB0byBleGNsdWRlIHRpbWUgcG9ydGlvbiBvZiB0aGUgdHdvIGRhdGVzXG4gICAgICogQHBhcmFtIGluY2x1ZGVEYXRlIHNldCB0byBmYWxzZSBpZiB5b3Ugd2FudCB0byBleGNsdWRlIHRoZSBkYXRlIHBvcnRpb24gb2YgdGhlIHR3byBkYXRlc1xuICAgICAqIEByZXR1cm5zIHRydWUgaWYgcHJvdmlkZWQgdmFsdWUgaXMgbGVzcyB0aGFuIHByb3ZpZGVkIG1pblZhbHVlXG4gICAgICovXG4gICAgcHVibGljIHN0YXRpYyBsZXNzVGhhbk1pblZhbHVlKHZhbHVlOiBEYXRlLCBtaW5WYWx1ZTogRGF0ZSwgaW5jbHVkZVRpbWUgPSB0cnVlLCBpbmNsdWRlRGF0ZSA9IHRydWUpOiBib29sZWFuIHtcbiAgICAgICAgaWYgKGluY2x1ZGVUaW1lICYmIGluY2x1ZGVEYXRlKSB7XG4gICAgICAgICAgICByZXR1cm4gdmFsdWUuZ2V0VGltZSgpIDwgbWluVmFsdWUuZ2V0VGltZSgpO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgX3ZhbHVlID0gbmV3IERhdGUodmFsdWUuZ2V0VGltZSgpKTtcbiAgICAgICAgY29uc3QgX21pblZhbHVlID0gbmV3IERhdGUobWluVmFsdWUuZ2V0VGltZSgpKTtcbiAgICAgICAgaWYgKCFpbmNsdWRlVGltZSkge1xuICAgICAgICAgICAgX3ZhbHVlLnNldEhvdXJzKDAsIDAsIDAsIDApO1xuICAgICAgICAgICAgX21pblZhbHVlLnNldEhvdXJzKDAsIDAsIDAsIDApO1xuICAgICAgICB9XG4gICAgICAgIGlmICghaW5jbHVkZURhdGUpIHtcbiAgICAgICAgICAgIF92YWx1ZS5zZXRGdWxsWWVhcigwLCAwLCAwKTtcbiAgICAgICAgICAgIF9taW5WYWx1ZS5zZXRGdWxsWWVhcigwLCAwLCAwKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBfdmFsdWUuZ2V0VGltZSgpIDwgX21pblZhbHVlLmdldFRpbWUoKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBWYWxpZGF0ZXMgYSB2YWx1ZSB3aXRoaW4gYSBnaXZlbiBtaW4gYW5kIG1heCB2YWx1ZSByYW5nZS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB2YWx1ZSBUaGUgdmFsdWUgdG8gdmFsaWRhdGVcbiAgICAgKiBAcGFyYW0gbWluVmFsdWUgVGhlIGxvd2VzdCBwb3NzaWJsZSB2YWx1ZSB0aGF0IGB2YWx1ZWAgY2FuIHRha2VcbiAgICAgKiBAcGFyYW0gbWF4VmFsdWUgVGhlIGxhcmdlc3QgcG9zc2libGUgdmFsdWUgdGhhdCBgdmFsdWVgIGNhbiB0YWtlXG4gICAgICovXG4gICAgcHVibGljIHN0YXRpYyB2YWxpZGF0ZU1pbk1heCh2YWx1ZTogRGF0ZSwgbWluVmFsdWU6IERhdGUgfCBzdHJpbmcsIG1heFZhbHVlOiBEYXRlIHwgc3RyaW5nLFxuICAgICAgICBpbmNsdWRlVGltZSA9IHRydWUsIGluY2x1ZGVEYXRlID0gdHJ1ZSk6IFZhbGlkYXRpb25FcnJvcnMge1xuICAgICAgICBpZiAoIXZhbHVlKSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBlcnJvcnMgPSB7fTtcbiAgICAgICAgY29uc3QgbWluID0gRGF0ZVRpbWVVdGlsLmlzVmFsaWREYXRlKG1pblZhbHVlKSA/IG1pblZhbHVlIDogRGF0ZVRpbWVVdGlsLnBhcnNlSXNvRGF0ZShtaW5WYWx1ZSk7XG4gICAgICAgIGNvbnN0IG1heCA9IERhdGVUaW1lVXRpbC5pc1ZhbGlkRGF0ZShtYXhWYWx1ZSkgPyBtYXhWYWx1ZSA6IERhdGVUaW1lVXRpbC5wYXJzZUlzb0RhdGUobWF4VmFsdWUpO1xuICAgICAgICBpZiAobWluICYmIHZhbHVlICYmIERhdGVUaW1lVXRpbC5sZXNzVGhhbk1pblZhbHVlKHZhbHVlLCBtaW4sIGluY2x1ZGVUaW1lLCBpbmNsdWRlRGF0ZSkpIHtcbiAgICAgICAgICAgIE9iamVjdC5hc3NpZ24oZXJyb3JzLCB7IG1pblZhbHVlOiB0cnVlIH0pO1xuICAgICAgICB9XG4gICAgICAgIGlmIChtYXggJiYgdmFsdWUgJiYgRGF0ZVRpbWVVdGlsLmdyZWF0ZXJUaGFuTWF4VmFsdWUodmFsdWUsIG1heCwgaW5jbHVkZVRpbWUsIGluY2x1ZGVEYXRlKSkge1xuICAgICAgICAgICAgT2JqZWN0LmFzc2lnbihlcnJvcnMsIHsgbWF4VmFsdWU6IHRydWUgfSk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gZXJyb3JzO1xuICAgIH1cblxuICAgIC8qKiBQYXJzZSBhbiBJU08gc3RyaW5nIHRvIGEgRGF0ZSAqL1xuICAgIHB1YmxpYyBzdGF0aWMgcGFyc2VJc29EYXRlKHZhbHVlOiBzdHJpbmcpOiBEYXRlIHwgbnVsbCB7XG4gICAgICAgIGxldCByZWdleCA9IC9eXFxkezR9L2c7XG4gICAgICAgIGNvbnN0IHRpbWVMaXRlcmFsID0gJ1QnO1xuICAgICAgICBpZiAocmVnZXgudGVzdCh2YWx1ZSkpIHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgRGF0ZSh2YWx1ZSArIGAke3ZhbHVlLmluZGV4T2YodGltZUxpdGVyYWwpID09PSAtMSA/ICdUMDA6MDA6MDAnIDogJyd9YCk7XG4gICAgICAgIH1cblxuICAgICAgICByZWdleCA9IC9eXFxkezJ9L2c7XG4gICAgICAgIGlmIChyZWdleC50ZXN0KHZhbHVlKSkge1xuICAgICAgICAgICAgY29uc3QgZGF0ZU5vdyA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKTtcbiAgICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBwcmVmZXItY29uc3RcbiAgICAgICAgICAgIGxldCBbZGF0ZVBhcnQsIF90aW1lUGFydF0gPSBkYXRlTm93LnNwbGl0KHRpbWVMaXRlcmFsKTtcbiAgICAgICAgICAgIHJldHVybiBuZXcgRGF0ZShgJHtkYXRlUGFydH1UJHt2YWx1ZX1gKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJldHVybnMgd2hldGhlciB0aGUgaW5wdXQgaXMgdmFsaWQgZGF0ZVxuICAgICAqXG4gICAgICogQHBhcmFtIHZhbHVlIGlucHV0IHRvIGNoZWNrXG4gICAgICogQHJldHVybnMgdHJ1ZSBpZiBwcm92aWRlZCBpbnB1dCBpcyBhIHZhbGlkIGRhdGVcbiAgICAgKi9cbiAgICBwdWJsaWMgc3RhdGljIGlzVmFsaWREYXRlKHZhbHVlOiBhbnkpOiB2YWx1ZSBpcyBEYXRlIHtcbiAgICAgICAgaWYgKGlzRGF0ZSh2YWx1ZSkpIHtcbiAgICAgICAgICAgIHJldHVybiAhaXNOYU4odmFsdWUuZ2V0VGltZSgpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBwcml2YXRlIHN0YXRpYyBhZGRDdXJyZW50UGFydChjdXJyZW50UGFydDogRGF0ZVBhcnRJbmZvLCBkYXRlVGltZVBhcnRzOiBEYXRlUGFydEluZm9bXSk6IHZvaWQge1xuICAgICAgICBEYXRlVGltZVV0aWwuZW5zdXJlTGVhZGluZ1plcm8oY3VycmVudFBhcnQpO1xuICAgICAgICBjdXJyZW50UGFydC5lbmQgPSBjdXJyZW50UGFydC5zdGFydCArIGN1cnJlbnRQYXJ0LmZvcm1hdC5sZW5ndGg7XG4gICAgICAgIGRhdGVUaW1lUGFydHMucHVzaChjdXJyZW50UGFydCk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBzdGF0aWMgZGF5c0luTW9udGgoZnVsbFllYXI6IG51bWJlciwgbW9udGg6IG51bWJlcik6IG51bWJlciB7XG4gICAgICAgIHJldHVybiBuZXcgRGF0ZShmdWxsWWVhciwgbW9udGggKyAxLCAwKS5nZXREYXRlKCk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBzdGF0aWMgdHJpbUVtcHR5UGxhY2Vob2xkZXJzKHZhbHVlOiBzdHJpbmcsIHByb21wdENoYXI/OiBzdHJpbmcpOiBzdHJpbmcge1xuICAgICAgICBjb25zdCByZXN1bHQgPSB2YWx1ZS5yZXBsYWNlKG5ldyBSZWdFeHAocHJvbXB0Q2hhciB8fCAnXycsICdnJyksICcnKTtcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9XG5cbiAgICBwcml2YXRlIHN0YXRpYyBnZXRNYXNrKGRhdGVTdHJ1Y3Q6IGFueVtdKTogc3RyaW5nIHtcbiAgICAgICAgY29uc3QgbWFzayA9IFtdO1xuICAgICAgICBmb3IgKGNvbnN0IHBhcnQgb2YgZGF0ZVN0cnVjdCkge1xuICAgICAgICAgICAgc3dpdGNoIChwYXJ0LmZvcm1hdFR5cGUpIHtcbiAgICAgICAgICAgICAgICBjYXNlIEZvcm1hdERlc2MuTnVtZXJpYzoge1xuICAgICAgICAgICAgICAgICAgICBpZiAocGFydC50eXBlID09PSBEYXRlUGFydHMuRGF5KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBtYXNrLnB1c2goJ2QnKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChwYXJ0LnR5cGUgPT09IERhdGVQYXJ0cy5Nb250aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbWFzay5wdXNoKCdNJyk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBtYXNrLnB1c2goJ3l5eXknKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY2FzZSBGb3JtYXREZXNjLlR3b0RpZ2l0czoge1xuICAgICAgICAgICAgICAgICAgICBpZiAocGFydC50eXBlID09PSBEYXRlUGFydHMuRGF5KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBtYXNrLnB1c2goJ2RkJyk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocGFydC50eXBlID09PSBEYXRlUGFydHMuTW9udGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1hc2sucHVzaCgnTU0nKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1hc2sucHVzaCgneXknKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHBhcnQudHlwZSA9PT0gRGF0ZVRpbWVVdGlsLlNFUEFSQVRPUikge1xuICAgICAgICAgICAgICAgIG1hc2sucHVzaChwYXJ0LnZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBtYXNrLmpvaW4oJycpO1xuICAgIH1cblxuICAgIHByaXZhdGUgc3RhdGljIGxvZ01pc3NpbmdMb2NhbGVTZXR0aW5ncyhsb2NhbGU6IHN0cmluZyk6IHZvaWQge1xuICAgICAgICBjb25zb2xlLndhcm4oYE1pc3NpbmcgbG9jYWxlIGRhdGEgZm9yIHRoZSBsb2NhbGUgJHtsb2NhbGV9LiBQbGVhc2UgcmVmZXIgdG8gaHR0cHM6Ly9hbmd1bGFyLmlvL2d1aWRlL2kxOG4jaTE4bi1waXBlc2ApO1xuICAgICAgICBjb25zb2xlLndhcm4oJ1VzaW5nIGRlZmF1bHQgYnJvd3NlciBsb2NhbGUgc2V0dGluZ3MuJyk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBzdGF0aWMgcHJlcGVuZFZhbHVlKHZhbHVlOiBudW1iZXIsIHBhcnRMZW5ndGg6IG51bWJlciwgcHJlcGVuZENoYXI6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgICAgIHJldHVybiAocHJlcGVuZENoYXIgKyB2YWx1ZS50b1N0cmluZygpKS5zbGljZSgtcGFydExlbmd0aCk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBzdGF0aWMgdG9Ud2VsdmVIb3VyRm9ybWF0KHZhbHVlOiBzdHJpbmcsIHByb21wdENoYXIgPSAnXycpOiBudW1iZXIge1xuICAgICAgICBsZXQgaG91ciA9IHBhcnNlSW50KHZhbHVlLnJlcGxhY2UobmV3IFJlZ0V4cChwcm9tcHRDaGFyLCAnZycpLCAnMCcpLCAxMCk7XG4gICAgICAgIGlmIChob3VyID4gMTIpIHtcbiAgICAgICAgICAgIGhvdXIgLT0gMTI7XG4gICAgICAgIH0gZWxzZSBpZiAoaG91ciA9PT0gMCkge1xuICAgICAgICAgICAgaG91ciA9IDEyO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGhvdXI7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBzdGF0aWMgZW5zdXJlTGVhZGluZ1plcm8ocGFydDogRGF0ZVBhcnRJbmZvKSB7XG4gICAgICAgIHN3aXRjaCAocGFydC50eXBlKSB7XG4gICAgICAgICAgICBjYXNlIERhdGVQYXJ0LkRhdGU6XG4gICAgICAgICAgICBjYXNlIERhdGVQYXJ0Lk1vbnRoOlxuICAgICAgICAgICAgY2FzZSBEYXRlUGFydC5Ib3VyczpcbiAgICAgICAgICAgIGNhc2UgRGF0ZVBhcnQuTWludXRlczpcbiAgICAgICAgICAgIGNhc2UgRGF0ZVBhcnQuU2Vjb25kczpcbiAgICAgICAgICAgICAgICBpZiAocGFydC5mb3JtYXQubGVuZ3RoID09PSAxKSB7XG4gICAgICAgICAgICAgICAgICAgIHBhcnQuZm9ybWF0ID0gcGFydC5mb3JtYXQucmVwZWF0KDIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgRGF0ZVBhcnQuRnJhY3Rpb25hbFNlY29uZHM6XG4gICAgICAgICAgICAgICAgcGFydC5mb3JtYXQgPSBwYXJ0LmZvcm1hdFswXS5yZXBlYXQoMyk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIHN0YXRpYyBnZXRDbGVhblZhbChpbnB1dERhdGE6IHN0cmluZywgZGF0ZVBhcnQ6IERhdGVQYXJ0SW5mbywgcHJvbXB0Q2hhcj86IHN0cmluZyk6IHN0cmluZyB7XG4gICAgICAgIHJldHVybiBEYXRlVGltZVV0aWwudHJpbUVtcHR5UGxhY2Vob2xkZXJzKGlucHV0RGF0YS5zdWJzdHJpbmcoZGF0ZVBhcnQuc3RhcnQsIGRhdGVQYXJ0LmVuZCksIHByb21wdENoYXIpO1xuICAgIH1cblxuICAgIHByaXZhdGUgc3RhdGljIGRldGVybWluZURhdGVQYXJ0KGNoYXI6IHN0cmluZyk6IERhdGVQYXJ0IHtcbiAgICAgICAgc3dpdGNoIChjaGFyKSB7XG4gICAgICAgICAgICBjYXNlICdkJzpcbiAgICAgICAgICAgIGNhc2UgJ0QnOlxuICAgICAgICAgICAgICAgIHJldHVybiBEYXRlUGFydC5EYXRlO1xuICAgICAgICAgICAgY2FzZSAnTSc6XG4gICAgICAgICAgICAgICAgcmV0dXJuIERhdGVQYXJ0Lk1vbnRoO1xuICAgICAgICAgICAgY2FzZSAneSc6XG4gICAgICAgICAgICBjYXNlICdZJzpcbiAgICAgICAgICAgICAgICByZXR1cm4gRGF0ZVBhcnQuWWVhcjtcbiAgICAgICAgICAgIGNhc2UgJ2gnOlxuICAgICAgICAgICAgY2FzZSAnSCc6XG4gICAgICAgICAgICAgICAgcmV0dXJuIERhdGVQYXJ0LkhvdXJzO1xuICAgICAgICAgICAgY2FzZSAnbSc6XG4gICAgICAgICAgICAgICAgcmV0dXJuIERhdGVQYXJ0Lk1pbnV0ZXM7XG4gICAgICAgICAgICBjYXNlICdzJzpcbiAgICAgICAgICAgICAgICByZXR1cm4gRGF0ZVBhcnQuU2Vjb25kcztcbiAgICAgICAgICAgIGNhc2UgJ1MnOlxuICAgICAgICAgICAgICAgIHJldHVybiBEYXRlUGFydC5GcmFjdGlvbmFsU2Vjb25kcztcbiAgICAgICAgICAgIGNhc2UgJ2EnOlxuICAgICAgICAgICAgY2FzZSAndCc6XG4gICAgICAgICAgICBjYXNlICdUJzpcbiAgICAgICAgICAgICAgICByZXR1cm4gRGF0ZVBhcnQuQW1QbTtcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgcmV0dXJuIERhdGVQYXJ0LkxpdGVyYWw7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIHN0YXRpYyBnZXREZWZhdWx0TG9jYWxlTWFzayhsb2NhbGU6IHN0cmluZykge1xuICAgICAgICBjb25zdCBkYXRlU3RydWN0ID0gW107XG4gICAgICAgIGNvbnN0IGZvcm1hdHRlciA9IG5ldyBJbnRsLkRhdGVUaW1lRm9ybWF0KGxvY2FsZSk7XG4gICAgICAgIGNvbnN0IGZvcm1hdFRvUGFydHMgPSBmb3JtYXR0ZXIuZm9ybWF0VG9QYXJ0cyhuZXcgRGF0ZSgpKTtcbiAgICAgICAgZm9yIChjb25zdCBwYXJ0IG9mIGZvcm1hdFRvUGFydHMpIHtcbiAgICAgICAgICAgIGlmIChwYXJ0LnR5cGUgPT09IERhdGVUaW1lVXRpbC5TRVBBUkFUT1IpIHtcbiAgICAgICAgICAgICAgICBkYXRlU3RydWN0LnB1c2goe1xuICAgICAgICAgICAgICAgICAgICB0eXBlOiBEYXRlVGltZVV0aWwuU0VQQVJBVE9SLFxuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogcGFydC52YWx1ZVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBkYXRlU3RydWN0LnB1c2goe1xuICAgICAgICAgICAgICAgICAgICB0eXBlOiBwYXJ0LnR5cGVcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBjb25zdCBmb3JtYXR0ZXJPcHRpb25zID0gZm9ybWF0dGVyLnJlc29sdmVkT3B0aW9ucygpO1xuICAgICAgICBmb3IgKGNvbnN0IHBhcnQgb2YgZGF0ZVN0cnVjdCkge1xuICAgICAgICAgICAgc3dpdGNoIChwYXJ0LnR5cGUpIHtcbiAgICAgICAgICAgICAgICBjYXNlIERhdGVQYXJ0cy5EYXk6IHtcbiAgICAgICAgICAgICAgICAgICAgcGFydC5mb3JtYXRUeXBlID0gZm9ybWF0dGVyT3B0aW9ucy5kYXk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjYXNlIERhdGVQYXJ0cy5Nb250aDoge1xuICAgICAgICAgICAgICAgICAgICBwYXJ0LmZvcm1hdFR5cGUgPSBmb3JtYXR0ZXJPcHRpb25zLm1vbnRoO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY2FzZSBEYXRlUGFydHMuWWVhcjoge1xuICAgICAgICAgICAgICAgICAgICBwYXJ0LmZvcm1hdFR5cGUgPSBmb3JtYXR0ZXJPcHRpb25zLnllYXI7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBEYXRlVGltZVV0aWwuZmlsbERhdGVQYXJ0c1Bvc2l0aW9ucyhkYXRlU3RydWN0KTtcbiAgICAgICAgcmV0dXJuIGRhdGVTdHJ1Y3Q7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBzdGF0aWMgZmlsbERhdGVQYXJ0c1Bvc2l0aW9ucyhkYXRlQXJyYXk6IGFueVtdKTogdm9pZCB7XG4gICAgICAgIGxldCBjdXJyZW50UG9zID0gMDtcblxuICAgICAgICBmb3IgKGNvbnN0IHBhcnQgb2YgZGF0ZUFycmF5KSB7XG4gICAgICAgICAgICAvLyBEYXl8TW9udGggcGFydCBwb3NpdGlvbnNcbiAgICAgICAgICAgIGlmIChwYXJ0LnR5cGUgPT09IERhdGVQYXJ0cy5EYXkgfHwgcGFydC50eXBlID09PSBEYXRlUGFydHMuTW9udGgpIHtcbiAgICAgICAgICAgICAgICAvLyBPZmZzZXQgMiBwb3NpdGlvbnMgZm9yIG51bWJlclxuICAgICAgICAgICAgICAgIHBhcnQucG9zaXRpb24gPSBbY3VycmVudFBvcywgY3VycmVudFBvcyArIDJdO1xuICAgICAgICAgICAgICAgIGN1cnJlbnRQb3MgKz0gMjtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAocGFydC50eXBlID09PSBEYXRlUGFydHMuWWVhcikge1xuICAgICAgICAgICAgICAgIC8vIFllYXIgcGFydCBwb3NpdGlvbnNcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKHBhcnQuZm9ybWF0VHlwZSkge1xuICAgICAgICAgICAgICAgICAgICBjYXNlIEZvcm1hdERlc2MuTnVtZXJpYzoge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gT2Zmc2V0IDQgcG9zaXRpb25zIGZvciBmdWxsIHllYXJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhcnQucG9zaXRpb24gPSBbY3VycmVudFBvcywgY3VycmVudFBvcyArIDRdO1xuICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudFBvcyArPSA0O1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgY2FzZSBGb3JtYXREZXNjLlR3b0RpZ2l0czoge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gT2Zmc2V0IDIgcG9zaXRpb25zIGZvciBzaG9ydCB5ZWFyXG4gICAgICAgICAgICAgICAgICAgICAgICBwYXJ0LnBvc2l0aW9uID0gW2N1cnJlbnRQb3MsIGN1cnJlbnRQb3MgKyAyXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRQb3MgKz0gMjtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIGlmIChwYXJ0LnR5cGUgPT09IERhdGVUaW1lVXRpbC5TRVBBUkFUT1IpIHtcbiAgICAgICAgICAgICAgICAvLyBTZXBhcmF0b3IgcG9zaXRpb25zXG4gICAgICAgICAgICAgICAgcGFydC5wb3NpdGlvbiA9IFtjdXJyZW50UG9zLCBjdXJyZW50UG9zICsgMV07XG4gICAgICAgICAgICAgICAgY3VycmVudFBvcysrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxufVxuIl19